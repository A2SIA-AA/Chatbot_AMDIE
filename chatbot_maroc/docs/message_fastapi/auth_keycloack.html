<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>message_fastapi.auth_keycloack API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>message_fastapi.auth_keycloack</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="message_fastapi.auth_keycloack.check_permission_keycloak"><code class="name flex">
<span>def <span class="ident">check_permission_keycloak</span></span>(<span>user: Dict, required_permission: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Vérifie si un utilisateur dispose d'une permission requise dans une liste de
permissions issues de Keycloak.</p>
<p>Cela permet de s'assurer qu'un utilisateur possède les permissions nécessaires,
telles que spécifiées dans <code>required_permission</code>, en vérifiant s'il est listé dans
les permissions de l'utilisateur.</p>
<p>:param user: Un dictionnaire représentant l'utilisateur, contenant potentiellement
une clé "permissions" listant les permissions dont l'utilisateur dispose.
:param required_permission: Une chaîne de caractères représentant la permission
exigée à vérifier.
:return: Retourne un booléen indiquant si la permission requise est présente parmi
les permissions associées à l'utilisateur.</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.exchange_code_for_token"><code class="name flex">
<span>def <span class="ident">exchange_code_for_token</span></span>(<span>code: str, redirect_uri: str) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Échange un code d'autorisation pour obtenir un jeton d'accès.</p>
<p>Cette fonction permet d'obtenir un jeton d'accès en utilisant un code
d'autorisation et une URI de redirection dans le cadre du flux
d'autorisation OAuth 2.0.</p>
<p>:param code: Le code d'autorisation obtenu depuis le fournisseur d'identité.
:type code: str
:param redirect_uri: L'URI de redirection utilisée pour obtenir le code
d'autorisation.
:type redirect_uri: str
:return: Un dictionnaire contenant le jeton d'accès et les informations
associées.
:rtype: dict
:raises HTTPException: Si une erreur se produit pendant le processus
d'échange, une exception est levée avec un statut HTTP 400 et un message
détaillant la cause de l'échec.</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.get_current_user_keycloak"><code class="name flex">
<span>async def <span class="ident">get_current_user_keycloak</span></span>(<span>credentials: fastapi.security.http.HTTPAuthorizationCredentials = Depends(HTTPBearer)) ‑> Dict</span>
</code></dt>
<dd>
<div class="desc"><p>Récupère les informations de l'utilisateur actuel via Keycloak.</p>
<p>Cette fonction utilise les informations contenues dans le token JWT fourni par Keycloak pour
extraire les données de l'utilisateur, telles que le nom, l'adresse e-mail, les rôles,
et autres détails, et les formate en un dictionnaire compatible avec les exigences actuelles
du système de gestion des rôles et permissions.</p>
<p>:param credentials: Credentials JWT utilisés pour l'authentification, extraits automatiquement
via <code>Depends(security)</code>.
:type credentials: HTTPAuthorizationCredentials
:return: Dictionnaire contenant les informations de l'utilisateur, incluant son nom,
adresse e-mail, rôle attribué, permissions associées, nom complet et département.
:rtype: Dict
:raises HTTPException: Si le token est invalide, expiré, ou incorrect.</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.get_keycloak_login_url"><code class="name flex">
<span>def <span class="ident">get_keycloak_login_url</span></span>(<span>redirect_uri: str | None = None) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Génère une URL de connexion pour Keycloak avec l'URI de redirection spécifié.</p>
<p>Si aucun <code>redirect_uri</code> n'est fourni, une valeur par défaut sera utilisée
pour permettre un flux standard côté API. Cette méthode retourne une URL
de point d'entrée pour démarrer un processus d'authentification OpenID
avec Keycloak.</p>
<p>:param redirect_uri: URI de redirection à utiliser après l'authentification.
Si aucun URI n'est fourni, une valeur par défaut sera utilisée.
:type redirect_uri: str | None
:return: URL de connexion Keycloak générée avec l'URI de redirection.
:rtype: str</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.get_permissions_from_role"><code class="name flex">
<span>def <span class="ident">get_permissions_from_role</span></span>(<span>role: str) ‑> List[str]</span>
</code></dt>
<dd>
<div class="desc"><p>Récupère la liste des permissions associées à un rôle spécifique.</p>
<p>Cette fonction permet de retourner les permissions correspondant à un rôle donné.
Si le rôle spécifié n'est pas trouvé dans le dictionnaire des permissions,
les permissions par défaut pour le rôle 'public' sont retournées.</p>
<p>:param role: Le rôle pour lequel récupérer les permissions. Les valeurs possibles
incluent 'public', 'employee' et 'admin'.
:type role: str
:return: Une liste de chaînes de caractères représentant les permissions associées
au rôle spécifié. Si le rôle n'est pas trouvé, retourne les permissions par
défaut pour le rôle 'public'.
:rtype: List[str]</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.keycloak_role_to_amdie_role"><code class="name flex">
<span>def <span class="ident">keycloak_role_to_amdie_role</span></span>(<span>keycloak_roles: List[str]) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Convertit un rôle de Keycloak en rôle AMDiE.</p>
<p>Cette fonction prend en entrée une liste de rôles Keycloak et renvoie un
rôle correspondant dans le système AMDiE. Les rôles possibles dans Keycloak
sont vérifiés séquentiellement selon une priorité définie et convertis en
« admin », « employee » ou « public ». Si aucun des rôles connus n'est
trouvé, la fonction renvoie « public » par défaut.</p>
<p>:param keycloak_roles: Liste des rôles en provenance de Keycloak.
:type keycloak_roles: List[str]
:return: Le rôle AMDiE correspondant au rôle Keycloak détecté.
:rtype: str</p></div>
</dd>
<dt id="message_fastapi.auth_keycloack.require_permission_keycloak"><code class="name flex">
<span>def <span class="ident">require_permission_keycloak</span></span>(<span>permission: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Vérifie si l'utilisateur authentifié dispose d'une permission spécifique dans Keycloak.</p>
<p>Cette fonction génère un "dépend" (Depends) qui peut être utilisé dans les routes FastAPI
pour restreindre l'accès aux utilisateurs ayant une permission donnée. Si la vérification
échoue, une exception HTTP 403 est levée.</p>
<p>:param permission: La permission spécifique requise pour accéder à une ressource.
:type permission: str
:return: Une fonction dépendante (checker) implémentant la vérification de permission.
:rtype: Callable
:raises HTTPException: Si l'utilisateur ne dispose pas de la permission requise.</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="message_fastapi" href="index.html">message_fastapi</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="message_fastapi.auth_keycloack.check_permission_keycloak" href="#message_fastapi.auth_keycloack.check_permission_keycloak">check_permission_keycloak</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.exchange_code_for_token" href="#message_fastapi.auth_keycloack.exchange_code_for_token">exchange_code_for_token</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.get_current_user_keycloak" href="#message_fastapi.auth_keycloack.get_current_user_keycloak">get_current_user_keycloak</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.get_keycloak_login_url" href="#message_fastapi.auth_keycloack.get_keycloak_login_url">get_keycloak_login_url</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.get_permissions_from_role" href="#message_fastapi.auth_keycloack.get_permissions_from_role">get_permissions_from_role</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.keycloak_role_to_amdie_role" href="#message_fastapi.auth_keycloack.keycloak_role_to_amdie_role">keycloak_role_to_amdie_role</a></code></li>
<li><code><a title="message_fastapi.auth_keycloack.require_permission_keycloak" href="#message_fastapi.auth_keycloack.require_permission_keycloak">require_permission_keycloak</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
