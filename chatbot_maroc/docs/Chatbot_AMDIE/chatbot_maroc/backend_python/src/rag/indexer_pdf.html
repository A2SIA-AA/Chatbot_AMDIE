<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>Chatbot_AMDIE.chatbot_maroc.backend_python.src.rag.indexer_pdf API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../rag.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;Chatbot_AMDIE.chatbot_maroc.backend_python.src.rag</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#PDFToChroma">PDFToChroma</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PDFToChroma.__init__">PDFToChroma</a>
                        </li>
                        <li>
                                <a class="variable" href="#PDFToChroma.client">client</a>
                        </li>
                        <li>
                                <a class="variable" href="#PDFToChroma.chroma_client">chroma_client</a>
                        </li>
                        <li>
                                <a class="variable" href="#PDFToChroma.collection">collection</a>
                        </li>
                        <li>
                                <a class="variable" href="#PDFToChroma.embedding_model">embedding_model</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.trouver_pdfs">trouver_pdfs</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.traiter_pdf_avec_gemini">traiter_pdf_avec_gemini</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.creer_json_resume">creer_json_resume</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.ajouter_a_chromadb">ajouter_a_chromadb</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.traiter_tous_les_pdfs">traiter_tous_les_pdfs</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.rechercher_pdfs">rechercher_pdfs</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.stats_collection">stats_collection</a>
                        </li>
                        <li>
                                <a class="function" href="#PDFToChroma.tester_acces_par_role">tester_acces_par_role</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
Chatbot_AMDIE<wbr>.chatbot_maroc<wbr>.<a href="./../../../backend_python.html">backend_python</a><wbr>.<a href="./../../src.html">src</a><wbr>.<a href="./../rag.html">rag</a><wbr>.indexer_pdf    </h1>

                
                        <input id="mod-indexer_pdf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-indexer_pdf-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">google</span><span class="w"> </span><span class="kn">import</span> <span class="n">genai</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">chromadb</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sentence_transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SentenceTransformer</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PDFToChroma</span><span class="p">:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    Cette classe est conçue pour traiter les documents PDF afin de déterminer leur</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    niveau d&#39;accès, générer des résumés à l&#39;aide d&#39;une API Gemini et les ajouter à</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    une base de données existante sous forme de vecteurs d&#39;embedding.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    La classe facilite également la gestion des contenus PDF au sein d&#39;une</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    collection ChromaDB, tout en créant des fichiers JSON structurés pour chaque document.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    :ivar client: Instance du client utilisé pour communiquer avec l&#39;API Gemini.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    :type client: genai.Client</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    :ivar chroma_client: Instance du client persistant pour accéder à ChromaDB.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    :type chroma_client: chromadb.PersistentClient</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    :ivar collection: Collection ChromaDB utilisée pour enregistrer les données liées aux documents PDF.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    :type collection: chromadb.collection.Collection</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    :ivar embedding_model: Modèle utilisé pour générer des embeddings de texte basés sur le contenu des documents.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    :type embedding_model: SentenceTransformer</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        Cette classe configure et initialise les composants nécessaires pour un chatbot.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        Elle est responsable de la configuration du client Gemini, de l&#39;accès à ChromaDB,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        et de l&#39;initialisation du modèle d&#39;embeddings de phrases.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Attributs</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        ---------</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        client : genai.Client</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            Un client configuré pour interagir avec le service Gemini.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        chroma_client : chromadb.PersistentClient</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">            Client configuré pour l&#39;accès à une base ChromaDB persistante.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        collection : chromadb.Collection</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">            Collection accessible dans ChromaDB contenant les données existantes.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        embedding_model : SentenceTransformer</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">            Modèle utilisé pour générer des embeddings à partir de phrases.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/home/aissa/Bureau/Projet_Chatbot/Chatbot_AMDIE/chatbot_maroc/backend_python&quot;</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="c1"># Configuration Gemini</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="c1"># Configuration ChromaDB - collection existante</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;RAG_DB_PATH&quot;</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;tableaux_maroc&quot;</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="c1"># Modèle d&#39;embeddings</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection tableaux_maroc: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents existants&quot;</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_determiner_niveau_acces_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        Détermine le niveau d&#39;accès pour un fichier PDF en fonction de son chemin, de ses dossiers</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">        parents et de son nom.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        La fonction analyse plusieurs aspects du chemin et des noms associés pour extraire des</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        informations permettant de classifier le fichier en niveaux d&#39;accès. Les niveaux possibles</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        sont &quot;confidential&quot;, &quot;internal&quot;, ou &quot;public&quot;. Les priorités d&#39;analyse incluent le nom du</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        dossier parent, le chemin complet, et le nom du fichier lui-même.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        :param pdf_path: Chemin du fichier PDF devant être analysé</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        :type pdf_path: Path</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        :return: Niveau d&#39;accès déterminé pour le fichier (&quot;confidential&quot;, &quot;internal&quot;, ou &quot;public&quot;)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        :rtype: str</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="c1"># Obtenir le chemin complet en minuscules pour l&#39;analyse</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">chemin_complet</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">dossier_parent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Analyse du chemin: </span><span class="si">{</span><span class="n">chemin_complet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Dossier parent: </span><span class="si">{</span><span class="n">dossier_parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">nom_dossier</span> <span class="o">=</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Nom dossier direct: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;administratif&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="k">elif</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;employee&#39;</span><span class="p">]:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="k">elif</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;publique&#39;</span><span class="p">]:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau PUBLIC via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]):</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via chemin complet&quot;</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                 <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;employee&#39;</span><span class="p">]):</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via chemin complet&quot;</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;publique&#39;</span><span class="p">]):</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau PUBLIC via chemin complet&quot;</span><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="n">nom_fichier</span> <span class="o">=</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">nom_fichier</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via nom fichier&quot;</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">nom_fichier</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">]):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via nom fichier&quot;</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="c1"># Par défaut: public</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Aucun indicateur trouvé, niveau par défaut: PUBLIC&quot;</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">trouver_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        Analyse un dossier donné et recherche récursivement tous les fichiers PDF</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        dans celui-ci et ses sous-dossiers. La fonction détermine également un</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">        niveau d&#39;accès pour chaque fichier PDF trouvé. Les résultats incluent le</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        chemin complet du fichier et son niveau d&#39;accès.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        :param dossier: Le chemin du dossier dans lequel rechercher les fichiers PDF.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        :type dossier: str, optionnel</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        :return: Une liste de tuples contenant pour chaque fichier PDF trouvé son chemin</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                 et son niveau d&#39;accès (sous forme de chaîne).</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        :rtype: list[tuple[Path, str]]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">dossier_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche de PDFs dans </span><span class="si">{</span><span class="n">dossier</span><span class="si">}</span><span class="s2"> et ses sous-dossiers...&quot;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="c1"># Parcourir récursivement tous les dossiers</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">for</span> <span class="n">racine</span><span class="p">,</span> <span class="n">repertoires</span><span class="p">,</span> <span class="n">fichiers</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dossier_path</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="n">racine_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">racine</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="k">for</span> <span class="n">fichier</span> <span class="ow">in</span> <span class="n">fichiers</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>                <span class="k">if</span> <span class="n">fichier</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                    <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">racine_path</span> <span class="o">/</span> <span class="n">fichier</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>                    <span class="n">access_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determiner_niveau_acces_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                    <span class="n">pdfs_avec_acces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">))</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trouvé: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total PDFs trouvés: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="c1"># Statistiques par niveau</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">stats_niveaux</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">niveau</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="n">stats_niveaux</span><span class="p">[</span><span class="n">niveau</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">niveau</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">pdfs_avec_acces</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        Traite un document PDF en utilisant l&#39;API Gemini pour en générer un résumé en français. Cette</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        fonction télécharge un fichier PDF, utilise le modèle Gemini pour générer un texte résumé en</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        fonction d&#39;une invite, et supprime ensuite le fichier distant pour optimiser l&#39;espace.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        :param pdf_path: Le chemin du fichier PDF à traiter.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        :type pdf_path: str</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        :return: Le résumé du document PDF, ou None si une erreur s&#39;est produite ou que la génération</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">                 ne contient pas de texte.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        :rtype: str, optional</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        :raises Exception: Exception générique si une erreur survient lors du processus.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traitement: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="c1"># Upload du PDF vers Gemini File API</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="n">sample_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uploaded: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="c1"># Demander résumé</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Résume ce document PDF, en français, en identifiant le titre, le type de document, le sujet principal et un résumé en 4-5 phrases.&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gemini-2.5-flash&quot;</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="n">contents</span><span class="o">=</span><span class="p">[</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">prompt</span><span class="p">]</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="c1"># Supprimer le fichier uploadé pour économiser l&#39;espace</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fichier supprimé: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Erreur: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">creer_json_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume_gemini</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        Génère un fichier JSON résumant les informations d&#39;un fichier PDF donné, en incluant</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        des métadonnées telles que le chemin d&#39;accès, la taille du fichier, le niveau d&#39;accès</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        et un résumé fourni.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        :param pdf_path: Chemin du fichier PDF source. Doit être de type Path.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        :type pdf_path: Path</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        :param access_level: Niveau d&#39;accès associé au PDF.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        :type access_level: str</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        :param resume_gemini: Résumé du document donné sous forme de chaîne de caractères.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        :type resume_gemini: str</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        :return: Dictionnaire contenant les métadonnées et informations générées pour le JSON.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        :rtype: dict</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="c1"># Sauvegarder le JSON</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="n">json_file</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="s2">&quot;resume_gemini&quot;</span><span class="p">:</span> <span class="n">resume_gemini</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="s2">&quot;fichier_source&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="s2">&quot;type_document&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="s2">&quot;taille_fichier&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="s2">&quot;titre_contextuel&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="s2">&quot;pdf_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">),</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="s2">&quot;source_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="s2">&quot;access_level&quot;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="s2">&quot;document_type&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="s2">&quot;access_indicator&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;PDF </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="p">}</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  JSON sauvé: </span><span class="si">{</span><span class="n">json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Niveau d&#39;accès: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">json_data</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ajouter_a_chromadb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        Ajoute un document PDF et ses métadonnées à une collection ChromaDB. Cette méthode</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        génère une description textuelle basée sur les données du document, crée un embedding</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        avec un modèle d&#39;encodage fourni, et enregistre les métadonnées ainsi que le contenu</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        associé dans la base de données.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        :param json_data: Un dictionnaire contenant les informations concernant le</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">            fichier PDF à traiter et à ajouter dans la base de données.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        :type json_data: dict</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        :return: L&#39;identifiant unique (ID) généré pour le document ajouté dans ChromaDB.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        :rtype: str</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="c1"># Créer description pour la recherche</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DOCUMENT PDF: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="s2">TYPE: Document PDF</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="s2">NIVEAU D&#39;ACCÈS: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="s2">DOSSIER: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="s2">CONTENU: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;resume_gemini&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="c1"># Générer embedding</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">description</span><span class="p">])</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1"># Métadonnées pour ChromaDB avec niveau d&#39;accès</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="s1">&#39;fichier_source&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">],</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="s1">&#39;type_document&#39;</span><span class="p">:</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="s1">&#39;taille_fichier&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;taille_fichier&#39;</span><span class="p">],</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="s1">&#39;pdf_path&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;pdf_path&#39;</span><span class="p">],</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="s1">&#39;source_directory&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">],</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">],</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="s1">&#39;document_type&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;document_type&#39;</span><span class="p">],</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="s1">&#39;access_indicator&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_indicator&#39;</span><span class="p">],</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="s1">&#39;titre_contextuel&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;titre_contextuel&#39;</span><span class="p">],</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="s1">&#39;description_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="p">}</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="c1"># Ajouter à la collection</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">doc_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="n">embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="n">description</span><span class="p">],</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="n">metadatas</span><span class="o">=</span><span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ajouté à ChromaDB: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> (niveau: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">doc_id</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_tous_les_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        Traite tous les fichiers PDF dans un dossier donné, génère des résumés,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        et les stocke dans une base de données avec un niveau d&#39;accès spécifié.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        Cette méthode utilise un flux de traitement qui comprend la recherche des PDF,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        leur analyse via un outil de résumé, la création de métadonnées adéquates et</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        l&#39;ajout à une base de données.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        Le traitement effectue les étapes suivantes :</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        - Recherche des PDF dans un dossier, avec identification de leur niveau d&#39;accès.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        - Création de résumés pour chaque fichier PDF.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        - Création de documents JSON contenant les résumés et leurs métadonnées associées.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        - Insertion des documents JSON dans une collection d&#39;une base de données.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        Cette méthode fournit un résumé détaillé sur les statistiques des fichiers PDF analysés</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        et donne un aperçu final des données ajoutées dans la base.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        :param dossier: Chemin du dossier contenant les fichiers PDF à traiter. Par défaut, &quot;data&quot;.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        :type dossier: str</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        :return: Aucune valeur n&#39;est retournée. Les opérations de traitement sont réalisées en place.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        :rtype: None</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== DÉBUT DU TRAITEMENT ===&quot;</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="c1"># 1. Trouver les PDFs avec leurs niveaux d&#39;accès</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trouver_pdfs</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun PDF trouvé&quot;</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="k">return</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="c1"># 2. Traiter chaque PDF</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="k">for</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">) ---&quot;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="c1"># Résumé avec Gemini</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="n">resume</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="c1"># Créer JSON avec niveau d&#39;accès</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_json_resume</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="c1"># Ajouter à ChromaDB</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">doc_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ajouter_a_chromadb</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="k">if</span> <span class="n">doc_id</span><span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                    <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Succès&quot;</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Échec&quot;</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="c1"># 3. Résultats finaux</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== RÉSULTATS ===&quot;</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PDFs traités avec succès: </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès traités:&quot;</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection ChromaDB: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents total&quot;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rechercher_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        Rechercher des fichiers PDF dans une collection en fonction d&#39;une requête donnée,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        du rôle utilisateur et du nombre de résultats souhaités. Les résultats retournés</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        sont filtrés en fonction du niveau d&#39;accès autorisé pour le rôle spécifié.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        :param query: La requête de recherche sous forme de texte.</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        :type query: str</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        :param user_role: Le rôle de l&#39;utilisateur effectuant la recherche (public, internal,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">            admin). Par défaut, il est défini sur &quot;public&quot;.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        :type user_role: str</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        :param n_results: Le nombre de résultats à retourner après filtrage basé sur le</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">            rôle utilisateur. Par défaut, 5 résultats sont retournés.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        :type n_results: int</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        :return: Une liste des résultats filtrés contenant des informations sur les fichiers</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            trouvés, telles que le nom du fichier, le type du document, le niveau</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">            d&#39;accès, la pertinence et le dossier source. Si aucun résultat n&#39;est trouvé,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">            retourne une liste vide.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        :rtype: list[dict]</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="c1"># Mapping des rôles utilisateur vers les niveaux d&#39;accès autorisés</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="n">roles_access</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>            <span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">],</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">],</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="p">}</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">niveaux_autorises</span> <span class="o">=</span> <span class="n">roles_access</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">])</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche pour rôle &#39;</span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">&#39; - Niveaux autorisés: </span><span class="si">{</span><span class="n">niveaux_autorises</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="c1"># Générer embedding de la requête</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">query</span><span class="p">])</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="c1"># Rechercher (plus de résultats pour permettre le filtrage)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="n">query_embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="n">n_results</span><span class="o">=</span><span class="n">n_results</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Plus de résultats pour filtrage</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="s1">&#39;metadatas&#39;</span><span class="p">,</span> <span class="s1">&#39;distances&#39;</span><span class="p">]</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Résultats pour &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; (rôle: </span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun résultat trouvé&quot;</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="k">return</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="n">resultats_filtres</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="c1"># Filtrer selon le rôle utilisateur</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">niveaux_autorises</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="n">resultats_filtres</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                    <span class="s1">&#39;fichier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">),</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                    <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                    <span class="s1">&#39;pertinence&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance</span><span class="p">,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                    <span class="s1">&#39;dossier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                <span class="p">})</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n_results</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                    <span class="k">break</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="c1"># Afficher les résultats filtrés</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">resultat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;fichier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Type: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> | Niveau: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Dossier: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;dossier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Pertinence: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;pertinence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="nb">print</span><span class="p">()</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="n">resultats_filtres</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        Calcule et affiche des statistiques sur une collection de documents.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        Cette méthode permet de collecter des statistiques sur la répartition des types</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        de documents et les niveaux d&#39;accès associés dans une collection donnée.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        Les informations sont extraites des métadonnées des documents.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        :return: Rien. Cette méthode imprime directement les statistiques dans la console.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        :rtype: None</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="c1"># Récupérer tous les documents</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">all_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">])</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="c1"># Compteurs</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">stats_par_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tableau&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;non_defini&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">]:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="c1"># Type de document</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="n">doc_type</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="n">doc_type</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;tableau&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="c1"># Niveau d&#39;accès</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="s1">&#39;non_defini&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== STATISTIQUES COLLECTION ===&quot;</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total documents: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par type:&quot;</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="k">for</span> <span class="n">type_doc</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">type_doc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tester_acces_par_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Effectue un test des niveaux d&#39;accès à une fonctionnalité de recherche de PDF selon</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        des rôles spécifiques.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        Le test est effectué pour les rôles suivants : &#39;public&#39;, &#39;internal&#39; et &#39;admin&#39;.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        Pour chacun de ces rôles, une recherche est réalisée avec un mot-clé donné, et les</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        résultats sont imprimés pour inspection. Cette méthode sert à évaluer si les restrictions</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        d&#39;accès basées sur les rôles fonctionnent correctement.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        :param query_test: La chaîne de recherche utilisée pour tester la fonctionnalité.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        :type query_test: str</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        :return: Aucun retour. Les résultats sont affichés dans la sortie standard.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">query_test</span> <span class="o">=</span> <span class="s2">&quot;rapport&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== TEST DES NIVEAUX D&#39;ACCÈS ===&quot;</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Test pour rôle: </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="n">resultats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rechercher_pdfs</span><span class="p">(</span><span class="n">query_test</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">    Classe principale pour la gestion et le traitement des documents PDF en vue d&#39;une conversion</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">    en représentations chromatiques. Cette classe intègre également une gestion des niveaux</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">    d&#39;accès basés sur différents rôles.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">    Méthodes :</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">        - traiter_tous_les_pdfs : Méthode permettant de traiter un ensemble de fichiers PDF</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">          à partir d&#39;un répertoire donné.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        - stats_collection : Méthode permettant d&#39;afficher les statistiques associées</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">          au traitement des fichiers PDF.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        - tester_acces_par_role : Méthode utilisée pour tester les autorisations d&#39;accès</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">          basées sur les rôles d&#39;utilisateur ou les niveaux d&#39;autorisation.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">PDFToChroma</span><span class="p">()</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="c1"># Traiter tous les PDFs avec gestion des niveaux d&#39;accès</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">traiter_tous_les_pdfs</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>    <span class="c1"># Afficher statistiques avec niveaux d&#39;accès</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">stats_collection</span><span class="p">()</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>    <span class="c1"># Test des niveaux d&#39;accès</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">tester_acces_par_role</span><span class="p">()</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="PDFToChroma">
                            <input id="PDFToChroma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PDFToChroma</span>:

                <label class="view-source-button" for="PDFToChroma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma-15"><a href="#PDFToChroma-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PDFToChroma</span><span class="p">:</span>
</span><span id="PDFToChroma-16"><a href="#PDFToChroma-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-17"><a href="#PDFToChroma-17"><span class="linenos"> 17</span></a><span class="sd">    Cette classe est conçue pour traiter les documents PDF afin de déterminer leur</span>
</span><span id="PDFToChroma-18"><a href="#PDFToChroma-18"><span class="linenos"> 18</span></a><span class="sd">    niveau d&#39;accès, générer des résumés à l&#39;aide d&#39;une API Gemini et les ajouter à</span>
</span><span id="PDFToChroma-19"><a href="#PDFToChroma-19"><span class="linenos"> 19</span></a><span class="sd">    une base de données existante sous forme de vecteurs d&#39;embedding.</span>
</span><span id="PDFToChroma-20"><a href="#PDFToChroma-20"><span class="linenos"> 20</span></a>
</span><span id="PDFToChroma-21"><a href="#PDFToChroma-21"><span class="linenos"> 21</span></a><span class="sd">    La classe facilite également la gestion des contenus PDF au sein d&#39;une</span>
</span><span id="PDFToChroma-22"><a href="#PDFToChroma-22"><span class="linenos"> 22</span></a><span class="sd">    collection ChromaDB, tout en créant des fichiers JSON structurés pour chaque document.</span>
</span><span id="PDFToChroma-23"><a href="#PDFToChroma-23"><span class="linenos"> 23</span></a>
</span><span id="PDFToChroma-24"><a href="#PDFToChroma-24"><span class="linenos"> 24</span></a><span class="sd">    :ivar client: Instance du client utilisé pour communiquer avec l&#39;API Gemini.</span>
</span><span id="PDFToChroma-25"><a href="#PDFToChroma-25"><span class="linenos"> 25</span></a><span class="sd">    :type client: genai.Client</span>
</span><span id="PDFToChroma-26"><a href="#PDFToChroma-26"><span class="linenos"> 26</span></a><span class="sd">    :ivar chroma_client: Instance du client persistant pour accéder à ChromaDB.</span>
</span><span id="PDFToChroma-27"><a href="#PDFToChroma-27"><span class="linenos"> 27</span></a><span class="sd">    :type chroma_client: chromadb.PersistentClient</span>
</span><span id="PDFToChroma-28"><a href="#PDFToChroma-28"><span class="linenos"> 28</span></a><span class="sd">    :ivar collection: Collection ChromaDB utilisée pour enregistrer les données liées aux documents PDF.</span>
</span><span id="PDFToChroma-29"><a href="#PDFToChroma-29"><span class="linenos"> 29</span></a><span class="sd">    :type collection: chromadb.collection.Collection</span>
</span><span id="PDFToChroma-30"><a href="#PDFToChroma-30"><span class="linenos"> 30</span></a><span class="sd">    :ivar embedding_model: Modèle utilisé pour générer des embeddings de texte basés sur le contenu des documents.</span>
</span><span id="PDFToChroma-31"><a href="#PDFToChroma-31"><span class="linenos"> 31</span></a><span class="sd">    :type embedding_model: SentenceTransformer</span>
</span><span id="PDFToChroma-32"><a href="#PDFToChroma-32"><span class="linenos"> 32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-33"><a href="#PDFToChroma-33"><span class="linenos"> 33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma-34"><a href="#PDFToChroma-34"><span class="linenos"> 34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-35"><a href="#PDFToChroma-35"><span class="linenos"> 35</span></a><span class="sd">        Cette classe configure et initialise les composants nécessaires pour un chatbot.</span>
</span><span id="PDFToChroma-36"><a href="#PDFToChroma-36"><span class="linenos"> 36</span></a><span class="sd">        Elle est responsable de la configuration du client Gemini, de l&#39;accès à ChromaDB,</span>
</span><span id="PDFToChroma-37"><a href="#PDFToChroma-37"><span class="linenos"> 37</span></a><span class="sd">        et de l&#39;initialisation du modèle d&#39;embeddings de phrases.</span>
</span><span id="PDFToChroma-38"><a href="#PDFToChroma-38"><span class="linenos"> 38</span></a>
</span><span id="PDFToChroma-39"><a href="#PDFToChroma-39"><span class="linenos"> 39</span></a><span class="sd">        Attributs</span>
</span><span id="PDFToChroma-40"><a href="#PDFToChroma-40"><span class="linenos"> 40</span></a><span class="sd">        ---------</span>
</span><span id="PDFToChroma-41"><a href="#PDFToChroma-41"><span class="linenos"> 41</span></a><span class="sd">        client : genai.Client</span>
</span><span id="PDFToChroma-42"><a href="#PDFToChroma-42"><span class="linenos"> 42</span></a><span class="sd">            Un client configuré pour interagir avec le service Gemini.</span>
</span><span id="PDFToChroma-43"><a href="#PDFToChroma-43"><span class="linenos"> 43</span></a><span class="sd">        chroma_client : chromadb.PersistentClient</span>
</span><span id="PDFToChroma-44"><a href="#PDFToChroma-44"><span class="linenos"> 44</span></a><span class="sd">            Client configuré pour l&#39;accès à une base ChromaDB persistante.</span>
</span><span id="PDFToChroma-45"><a href="#PDFToChroma-45"><span class="linenos"> 45</span></a><span class="sd">        collection : chromadb.Collection</span>
</span><span id="PDFToChroma-46"><a href="#PDFToChroma-46"><span class="linenos"> 46</span></a><span class="sd">            Collection accessible dans ChromaDB contenant les données existantes.</span>
</span><span id="PDFToChroma-47"><a href="#PDFToChroma-47"><span class="linenos"> 47</span></a><span class="sd">        embedding_model : SentenceTransformer</span>
</span><span id="PDFToChroma-48"><a href="#PDFToChroma-48"><span class="linenos"> 48</span></a><span class="sd">            Modèle utilisé pour générer des embeddings à partir de phrases.</span>
</span><span id="PDFToChroma-49"><a href="#PDFToChroma-49"><span class="linenos"> 49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-50"><a href="#PDFToChroma-50"><span class="linenos"> 50</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/home/aissa/Bureau/Projet_Chatbot/Chatbot_AMDIE/chatbot_maroc/backend_python&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-51"><a href="#PDFToChroma-51"><span class="linenos"> 51</span></a>        <span class="c1"># Configuration Gemini</span>
</span><span id="PDFToChroma-52"><a href="#PDFToChroma-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span><span id="PDFToChroma-53"><a href="#PDFToChroma-53"><span class="linenos"> 53</span></a>
</span><span id="PDFToChroma-54"><a href="#PDFToChroma-54"><span class="linenos"> 54</span></a>        <span class="c1"># Configuration ChromaDB - collection existante</span>
</span><span id="PDFToChroma-55"><a href="#PDFToChroma-55"><span class="linenos"> 55</span></a>        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;RAG_DB_PATH&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-56"><a href="#PDFToChroma-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>
</span><span id="PDFToChroma-57"><a href="#PDFToChroma-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;tableaux_maroc&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-58"><a href="#PDFToChroma-58"><span class="linenos"> 58</span></a>
</span><span id="PDFToChroma-59"><a href="#PDFToChroma-59"><span class="linenos"> 59</span></a>        <span class="c1"># Modèle d&#39;embeddings</span>
</span><span id="PDFToChroma-60"><a href="#PDFToChroma-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-61"><a href="#PDFToChroma-61"><span class="linenos"> 61</span></a>
</span><span id="PDFToChroma-62"><a href="#PDFToChroma-62"><span class="linenos"> 62</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection tableaux_maroc: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents existants&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-63"><a href="#PDFToChroma-63"><span class="linenos"> 63</span></a>
</span><span id="PDFToChroma-64"><a href="#PDFToChroma-64"><span class="linenos"> 64</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_determiner_niveau_acces_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PDFToChroma-65"><a href="#PDFToChroma-65"><span class="linenos"> 65</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-66"><a href="#PDFToChroma-66"><span class="linenos"> 66</span></a><span class="sd">        Détermine le niveau d&#39;accès pour un fichier PDF en fonction de son chemin, de ses dossiers</span>
</span><span id="PDFToChroma-67"><a href="#PDFToChroma-67"><span class="linenos"> 67</span></a><span class="sd">        parents et de son nom.</span>
</span><span id="PDFToChroma-68"><a href="#PDFToChroma-68"><span class="linenos"> 68</span></a>
</span><span id="PDFToChroma-69"><a href="#PDFToChroma-69"><span class="linenos"> 69</span></a><span class="sd">        La fonction analyse plusieurs aspects du chemin et des noms associés pour extraire des</span>
</span><span id="PDFToChroma-70"><a href="#PDFToChroma-70"><span class="linenos"> 70</span></a><span class="sd">        informations permettant de classifier le fichier en niveaux d&#39;accès. Les niveaux possibles</span>
</span><span id="PDFToChroma-71"><a href="#PDFToChroma-71"><span class="linenos"> 71</span></a><span class="sd">        sont &quot;confidential&quot;, &quot;internal&quot;, ou &quot;public&quot;. Les priorités d&#39;analyse incluent le nom du</span>
</span><span id="PDFToChroma-72"><a href="#PDFToChroma-72"><span class="linenos"> 72</span></a><span class="sd">        dossier parent, le chemin complet, et le nom du fichier lui-même.</span>
</span><span id="PDFToChroma-73"><a href="#PDFToChroma-73"><span class="linenos"> 73</span></a>
</span><span id="PDFToChroma-74"><a href="#PDFToChroma-74"><span class="linenos"> 74</span></a><span class="sd">        :param pdf_path: Chemin du fichier PDF devant être analysé</span>
</span><span id="PDFToChroma-75"><a href="#PDFToChroma-75"><span class="linenos"> 75</span></a><span class="sd">        :type pdf_path: Path</span>
</span><span id="PDFToChroma-76"><a href="#PDFToChroma-76"><span class="linenos"> 76</span></a><span class="sd">        :return: Niveau d&#39;accès déterminé pour le fichier (&quot;confidential&quot;, &quot;internal&quot;, ou &quot;public&quot;)</span>
</span><span id="PDFToChroma-77"><a href="#PDFToChroma-77"><span class="linenos"> 77</span></a><span class="sd">        :rtype: str</span>
</span><span id="PDFToChroma-78"><a href="#PDFToChroma-78"><span class="linenos"> 78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-79"><a href="#PDFToChroma-79"><span class="linenos"> 79</span></a>        <span class="c1"># Obtenir le chemin complet en minuscules pour l&#39;analyse</span>
</span><span id="PDFToChroma-80"><a href="#PDFToChroma-80"><span class="linenos"> 80</span></a>        <span class="n">chemin_complet</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PDFToChroma-81"><a href="#PDFToChroma-81"><span class="linenos"> 81</span></a>        <span class="n">dossier_parent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PDFToChroma-82"><a href="#PDFToChroma-82"><span class="linenos"> 82</span></a>
</span><span id="PDFToChroma-83"><a href="#PDFToChroma-83"><span class="linenos"> 83</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Analyse du chemin: </span><span class="si">{</span><span class="n">chemin_complet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-84"><a href="#PDFToChroma-84"><span class="linenos"> 84</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Dossier parent: </span><span class="si">{</span><span class="n">dossier_parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-85"><a href="#PDFToChroma-85"><span class="linenos"> 85</span></a>
</span><span id="PDFToChroma-86"><a href="#PDFToChroma-86"><span class="linenos"> 86</span></a>        <span class="n">nom_dossier</span> <span class="o">=</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PDFToChroma-87"><a href="#PDFToChroma-87"><span class="linenos"> 87</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Nom dossier direct: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-88"><a href="#PDFToChroma-88"><span class="linenos"> 88</span></a>
</span><span id="PDFToChroma-89"><a href="#PDFToChroma-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;administratif&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma-90"><a href="#PDFToChroma-90"><span class="linenos"> 90</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-91"><a href="#PDFToChroma-91"><span class="linenos"> 91</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="PDFToChroma-92"><a href="#PDFToChroma-92"><span class="linenos"> 92</span></a>        <span class="k">elif</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;employee&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma-93"><a href="#PDFToChroma-93"><span class="linenos"> 93</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-94"><a href="#PDFToChroma-94"><span class="linenos"> 94</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="PDFToChroma-95"><a href="#PDFToChroma-95"><span class="linenos"> 95</span></a>        <span class="k">elif</span> <span class="n">nom_dossier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;publique&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma-96"><a href="#PDFToChroma-96"><span class="linenos"> 96</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau PUBLIC via nom dossier: </span><span class="si">{</span><span class="n">nom_dossier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-97"><a href="#PDFToChroma-97"><span class="linenos"> 97</span></a>            <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="PDFToChroma-98"><a href="#PDFToChroma-98"><span class="linenos"> 98</span></a>
</span><span id="PDFToChroma-99"><a href="#PDFToChroma-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]):</span>
</span><span id="PDFToChroma-100"><a href="#PDFToChroma-100"><span class="linenos">100</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via chemin complet&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-101"><a href="#PDFToChroma-101"><span class="linenos">101</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="PDFToChroma-102"><a href="#PDFToChroma-102"><span class="linenos">102</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span>
</span><span id="PDFToChroma-103"><a href="#PDFToChroma-103"><span class="linenos">103</span></a>                 <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;employee&#39;</span><span class="p">]):</span>
</span><span id="PDFToChroma-104"><a href="#PDFToChroma-104"><span class="linenos">104</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via chemin complet&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-105"><a href="#PDFToChroma-105"><span class="linenos">105</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="PDFToChroma-106"><a href="#PDFToChroma-106"><span class="linenos">106</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">chemin_complet</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;publique&#39;</span><span class="p">]):</span>
</span><span id="PDFToChroma-107"><a href="#PDFToChroma-107"><span class="linenos">107</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau PUBLIC via chemin complet&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-108"><a href="#PDFToChroma-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="PDFToChroma-109"><a href="#PDFToChroma-109"><span class="linenos">109</span></a>
</span><span id="PDFToChroma-110"><a href="#PDFToChroma-110"><span class="linenos">110</span></a>        <span class="n">nom_fichier</span> <span class="o">=</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PDFToChroma-111"><a href="#PDFToChroma-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">nom_fichier</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;confidentiel&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]):</span>
</span><span id="PDFToChroma-112"><a href="#PDFToChroma-112"><span class="linenos">112</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau CONFIDENTIEL via nom fichier&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-113"><a href="#PDFToChroma-113"><span class="linenos">113</span></a>            <span class="k">return</span> <span class="s1">&#39;confidential&#39;</span>
</span><span id="PDFToChroma-114"><a href="#PDFToChroma-114"><span class="linenos">114</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">mot</span> <span class="ow">in</span> <span class="n">nom_fichier</span> <span class="k">for</span> <span class="n">mot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;salarie&#39;</span><span class="p">,</span> <span class="s1">&#39;employe&#39;</span><span class="p">,</span> <span class="s1">&#39;interne&#39;</span><span class="p">,</span> <span class="s1">&#39;personnel&#39;</span><span class="p">]):</span>
</span><span id="PDFToChroma-115"><a href="#PDFToChroma-115"><span class="linenos">115</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Détecté niveau INTERNE via nom fichier&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-116"><a href="#PDFToChroma-116"><span class="linenos">116</span></a>            <span class="k">return</span> <span class="s1">&#39;internal&#39;</span>
</span><span id="PDFToChroma-117"><a href="#PDFToChroma-117"><span class="linenos">117</span></a>
</span><span id="PDFToChroma-118"><a href="#PDFToChroma-118"><span class="linenos">118</span></a>        <span class="c1"># Par défaut: public</span>
</span><span id="PDFToChroma-119"><a href="#PDFToChroma-119"><span class="linenos">119</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG PDF: Aucun indicateur trouvé, niveau par défaut: PUBLIC&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-120"><a href="#PDFToChroma-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="s1">&#39;public&#39;</span>
</span><span id="PDFToChroma-121"><a href="#PDFToChroma-121"><span class="linenos">121</span></a>
</span><span id="PDFToChroma-122"><a href="#PDFToChroma-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">trouver_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="PDFToChroma-123"><a href="#PDFToChroma-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-124"><a href="#PDFToChroma-124"><span class="linenos">124</span></a><span class="sd">        Analyse un dossier donné et recherche récursivement tous les fichiers PDF</span>
</span><span id="PDFToChroma-125"><a href="#PDFToChroma-125"><span class="linenos">125</span></a><span class="sd">        dans celui-ci et ses sous-dossiers. La fonction détermine également un</span>
</span><span id="PDFToChroma-126"><a href="#PDFToChroma-126"><span class="linenos">126</span></a><span class="sd">        niveau d&#39;accès pour chaque fichier PDF trouvé. Les résultats incluent le</span>
</span><span id="PDFToChroma-127"><a href="#PDFToChroma-127"><span class="linenos">127</span></a><span class="sd">        chemin complet du fichier et son niveau d&#39;accès.</span>
</span><span id="PDFToChroma-128"><a href="#PDFToChroma-128"><span class="linenos">128</span></a>
</span><span id="PDFToChroma-129"><a href="#PDFToChroma-129"><span class="linenos">129</span></a><span class="sd">        :param dossier: Le chemin du dossier dans lequel rechercher les fichiers PDF.</span>
</span><span id="PDFToChroma-130"><a href="#PDFToChroma-130"><span class="linenos">130</span></a><span class="sd">        :type dossier: str, optionnel</span>
</span><span id="PDFToChroma-131"><a href="#PDFToChroma-131"><span class="linenos">131</span></a><span class="sd">        :return: Une liste de tuples contenant pour chaque fichier PDF trouvé son chemin</span>
</span><span id="PDFToChroma-132"><a href="#PDFToChroma-132"><span class="linenos">132</span></a><span class="sd">                 et son niveau d&#39;accès (sous forme de chaîne).</span>
</span><span id="PDFToChroma-133"><a href="#PDFToChroma-133"><span class="linenos">133</span></a><span class="sd">        :rtype: list[tuple[Path, str]]</span>
</span><span id="PDFToChroma-134"><a href="#PDFToChroma-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-135"><a href="#PDFToChroma-135"><span class="linenos">135</span></a>        <span class="n">dossier_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="PDFToChroma-136"><a href="#PDFToChroma-136"><span class="linenos">136</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PDFToChroma-137"><a href="#PDFToChroma-137"><span class="linenos">137</span></a>
</span><span id="PDFToChroma-138"><a href="#PDFToChroma-138"><span class="linenos">138</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche de PDFs dans </span><span class="si">{</span><span class="n">dossier</span><span class="si">}</span><span class="s2"> et ses sous-dossiers...&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-139"><a href="#PDFToChroma-139"><span class="linenos">139</span></a>
</span><span id="PDFToChroma-140"><a href="#PDFToChroma-140"><span class="linenos">140</span></a>        <span class="c1"># Parcourir récursivement tous les dossiers</span>
</span><span id="PDFToChroma-141"><a href="#PDFToChroma-141"><span class="linenos">141</span></a>        <span class="k">for</span> <span class="n">racine</span><span class="p">,</span> <span class="n">repertoires</span><span class="p">,</span> <span class="n">fichiers</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dossier_path</span><span class="p">):</span>
</span><span id="PDFToChroma-142"><a href="#PDFToChroma-142"><span class="linenos">142</span></a>            <span class="n">racine_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">racine</span><span class="p">)</span>
</span><span id="PDFToChroma-143"><a href="#PDFToChroma-143"><span class="linenos">143</span></a>
</span><span id="PDFToChroma-144"><a href="#PDFToChroma-144"><span class="linenos">144</span></a>            <span class="k">for</span> <span class="n">fichier</span> <span class="ow">in</span> <span class="n">fichiers</span><span class="p">:</span>
</span><span id="PDFToChroma-145"><a href="#PDFToChroma-145"><span class="linenos">145</span></a>                <span class="k">if</span> <span class="n">fichier</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">):</span>
</span><span id="PDFToChroma-146"><a href="#PDFToChroma-146"><span class="linenos">146</span></a>                    <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">racine_path</span> <span class="o">/</span> <span class="n">fichier</span>
</span><span id="PDFToChroma-147"><a href="#PDFToChroma-147"><span class="linenos">147</span></a>                    <span class="n">access_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determiner_niveau_acces_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma-148"><a href="#PDFToChroma-148"><span class="linenos">148</span></a>
</span><span id="PDFToChroma-149"><a href="#PDFToChroma-149"><span class="linenos">149</span></a>                    <span class="n">pdfs_avec_acces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">))</span>
</span><span id="PDFToChroma-150"><a href="#PDFToChroma-150"><span class="linenos">150</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trouvé: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-151"><a href="#PDFToChroma-151"><span class="linenos">151</span></a>
</span><span id="PDFToChroma-152"><a href="#PDFToChroma-152"><span class="linenos">152</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total PDFs trouvés: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-153"><a href="#PDFToChroma-153"><span class="linenos">153</span></a>
</span><span id="PDFToChroma-154"><a href="#PDFToChroma-154"><span class="linenos">154</span></a>        <span class="c1"># Statistiques par niveau</span>
</span><span id="PDFToChroma-155"><a href="#PDFToChroma-155"><span class="linenos">155</span></a>        <span class="n">stats_niveaux</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PDFToChroma-156"><a href="#PDFToChroma-156"><span class="linenos">156</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">niveau</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma-157"><a href="#PDFToChroma-157"><span class="linenos">157</span></a>            <span class="n">stats_niveaux</span><span class="p">[</span><span class="n">niveau</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">niveau</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PDFToChroma-158"><a href="#PDFToChroma-158"><span class="linenos">158</span></a>
</span><span id="PDFToChroma-159"><a href="#PDFToChroma-159"><span class="linenos">159</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-160"><a href="#PDFToChroma-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma-161"><a href="#PDFToChroma-161"><span class="linenos">161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-162"><a href="#PDFToChroma-162"><span class="linenos">162</span></a>
</span><span id="PDFToChroma-163"><a href="#PDFToChroma-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">pdfs_avec_acces</span>
</span><span id="PDFToChroma-164"><a href="#PDFToChroma-164"><span class="linenos">164</span></a>
</span><span id="PDFToChroma-165"><a href="#PDFToChroma-165"><span class="linenos">165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">):</span>
</span><span id="PDFToChroma-166"><a href="#PDFToChroma-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-167"><a href="#PDFToChroma-167"><span class="linenos">167</span></a><span class="sd">        Traite un document PDF en utilisant l&#39;API Gemini pour en générer un résumé en français. Cette</span>
</span><span id="PDFToChroma-168"><a href="#PDFToChroma-168"><span class="linenos">168</span></a><span class="sd">        fonction télécharge un fichier PDF, utilise le modèle Gemini pour générer un texte résumé en</span>
</span><span id="PDFToChroma-169"><a href="#PDFToChroma-169"><span class="linenos">169</span></a><span class="sd">        fonction d&#39;une invite, et supprime ensuite le fichier distant pour optimiser l&#39;espace.</span>
</span><span id="PDFToChroma-170"><a href="#PDFToChroma-170"><span class="linenos">170</span></a>
</span><span id="PDFToChroma-171"><a href="#PDFToChroma-171"><span class="linenos">171</span></a><span class="sd">        :param pdf_path: Le chemin du fichier PDF à traiter.</span>
</span><span id="PDFToChroma-172"><a href="#PDFToChroma-172"><span class="linenos">172</span></a><span class="sd">        :type pdf_path: str</span>
</span><span id="PDFToChroma-173"><a href="#PDFToChroma-173"><span class="linenos">173</span></a><span class="sd">        :return: Le résumé du document PDF, ou None si une erreur s&#39;est produite ou que la génération</span>
</span><span id="PDFToChroma-174"><a href="#PDFToChroma-174"><span class="linenos">174</span></a><span class="sd">                 ne contient pas de texte.</span>
</span><span id="PDFToChroma-175"><a href="#PDFToChroma-175"><span class="linenos">175</span></a><span class="sd">        :rtype: str, optional</span>
</span><span id="PDFToChroma-176"><a href="#PDFToChroma-176"><span class="linenos">176</span></a><span class="sd">        :raises Exception: Exception générique si une erreur survient lors du processus.</span>
</span><span id="PDFToChroma-177"><a href="#PDFToChroma-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-178"><a href="#PDFToChroma-178"><span class="linenos">178</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traitement: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-179"><a href="#PDFToChroma-179"><span class="linenos">179</span></a>
</span><span id="PDFToChroma-180"><a href="#PDFToChroma-180"><span class="linenos">180</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PDFToChroma-181"><a href="#PDFToChroma-181"><span class="linenos">181</span></a>            <span class="c1"># Upload du PDF vers Gemini File API</span>
</span><span id="PDFToChroma-182"><a href="#PDFToChroma-182"><span class="linenos">182</span></a>            <span class="n">sample_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma-183"><a href="#PDFToChroma-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uploaded: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-184"><a href="#PDFToChroma-184"><span class="linenos">184</span></a>
</span><span id="PDFToChroma-185"><a href="#PDFToChroma-185"><span class="linenos">185</span></a>            <span class="c1"># Demander résumé</span>
</span><span id="PDFToChroma-186"><a href="#PDFToChroma-186"><span class="linenos">186</span></a>            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Résume ce document PDF, en français, en identifiant le titre, le type de document, le sujet principal et un résumé en 4-5 phrases.&quot;</span>
</span><span id="PDFToChroma-187"><a href="#PDFToChroma-187"><span class="linenos">187</span></a>
</span><span id="PDFToChroma-188"><a href="#PDFToChroma-188"><span class="linenos">188</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
</span><span id="PDFToChroma-189"><a href="#PDFToChroma-189"><span class="linenos">189</span></a>                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gemini-2.5-flash&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma-190"><a href="#PDFToChroma-190"><span class="linenos">190</span></a>                <span class="n">contents</span><span class="o">=</span><span class="p">[</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">prompt</span><span class="p">]</span>
</span><span id="PDFToChroma-191"><a href="#PDFToChroma-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="PDFToChroma-192"><a href="#PDFToChroma-192"><span class="linenos">192</span></a>
</span><span id="PDFToChroma-193"><a href="#PDFToChroma-193"><span class="linenos">193</span></a>            <span class="c1"># Supprimer le fichier uploadé pour économiser l&#39;espace</span>
</span><span id="PDFToChroma-194"><a href="#PDFToChroma-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="PDFToChroma-195"><a href="#PDFToChroma-195"><span class="linenos">195</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fichier supprimé: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-196"><a href="#PDFToChroma-196"><span class="linenos">196</span></a>
</span><span id="PDFToChroma-197"><a href="#PDFToChroma-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span><span id="PDFToChroma-198"><a href="#PDFToChroma-198"><span class="linenos">198</span></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="PDFToChroma-199"><a href="#PDFToChroma-199"><span class="linenos">199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma-200"><a href="#PDFToChroma-200"><span class="linenos">200</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="PDFToChroma-201"><a href="#PDFToChroma-201"><span class="linenos">201</span></a>
</span><span id="PDFToChroma-202"><a href="#PDFToChroma-202"><span class="linenos">202</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PDFToChroma-203"><a href="#PDFToChroma-203"><span class="linenos">203</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Erreur: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-204"><a href="#PDFToChroma-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PDFToChroma-205"><a href="#PDFToChroma-205"><span class="linenos">205</span></a>
</span><span id="PDFToChroma-206"><a href="#PDFToChroma-206"><span class="linenos">206</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">creer_json_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume_gemini</span><span class="p">):</span>
</span><span id="PDFToChroma-207"><a href="#PDFToChroma-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-208"><a href="#PDFToChroma-208"><span class="linenos">208</span></a><span class="sd">        Génère un fichier JSON résumant les informations d&#39;un fichier PDF donné, en incluant</span>
</span><span id="PDFToChroma-209"><a href="#PDFToChroma-209"><span class="linenos">209</span></a><span class="sd">        des métadonnées telles que le chemin d&#39;accès, la taille du fichier, le niveau d&#39;accès</span>
</span><span id="PDFToChroma-210"><a href="#PDFToChroma-210"><span class="linenos">210</span></a><span class="sd">        et un résumé fourni.</span>
</span><span id="PDFToChroma-211"><a href="#PDFToChroma-211"><span class="linenos">211</span></a>
</span><span id="PDFToChroma-212"><a href="#PDFToChroma-212"><span class="linenos">212</span></a><span class="sd">        :param pdf_path: Chemin du fichier PDF source. Doit être de type Path.</span>
</span><span id="PDFToChroma-213"><a href="#PDFToChroma-213"><span class="linenos">213</span></a><span class="sd">        :type pdf_path: Path</span>
</span><span id="PDFToChroma-214"><a href="#PDFToChroma-214"><span class="linenos">214</span></a><span class="sd">        :param access_level: Niveau d&#39;accès associé au PDF.</span>
</span><span id="PDFToChroma-215"><a href="#PDFToChroma-215"><span class="linenos">215</span></a><span class="sd">        :type access_level: str</span>
</span><span id="PDFToChroma-216"><a href="#PDFToChroma-216"><span class="linenos">216</span></a><span class="sd">        :param resume_gemini: Résumé du document donné sous forme de chaîne de caractères.</span>
</span><span id="PDFToChroma-217"><a href="#PDFToChroma-217"><span class="linenos">217</span></a><span class="sd">        :type resume_gemini: str</span>
</span><span id="PDFToChroma-218"><a href="#PDFToChroma-218"><span class="linenos">218</span></a><span class="sd">        :return: Dictionnaire contenant les métadonnées et informations générées pour le JSON.</span>
</span><span id="PDFToChroma-219"><a href="#PDFToChroma-219"><span class="linenos">219</span></a><span class="sd">        :rtype: dict</span>
</span><span id="PDFToChroma-220"><a href="#PDFToChroma-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-221"><a href="#PDFToChroma-221"><span class="linenos">221</span></a>        <span class="c1"># Sauvegarder le JSON</span>
</span><span id="PDFToChroma-222"><a href="#PDFToChroma-222"><span class="linenos">222</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-223"><a href="#PDFToChroma-223"><span class="linenos">223</span></a>        <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PDFToChroma-224"><a href="#PDFToChroma-224"><span class="linenos">224</span></a>
</span><span id="PDFToChroma-225"><a href="#PDFToChroma-225"><span class="linenos">225</span></a>        <span class="n">json_file</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span id="PDFToChroma-226"><a href="#PDFToChroma-226"><span class="linenos">226</span></a>
</span><span id="PDFToChroma-227"><a href="#PDFToChroma-227"><span class="linenos">227</span></a>        <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma-228"><a href="#PDFToChroma-228"><span class="linenos">228</span></a>            <span class="s2">&quot;resume_gemini&quot;</span><span class="p">:</span> <span class="n">resume_gemini</span><span class="p">,</span>
</span><span id="PDFToChroma-229"><a href="#PDFToChroma-229"><span class="linenos">229</span></a>            <span class="s2">&quot;fichier_source&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="PDFToChroma-230"><a href="#PDFToChroma-230"><span class="linenos">230</span></a>            <span class="s2">&quot;type_document&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma-231"><a href="#PDFToChroma-231"><span class="linenos">231</span></a>            <span class="s2">&quot;taille_fichier&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
</span><span id="PDFToChroma-232"><a href="#PDFToChroma-232"><span class="linenos">232</span></a>            <span class="s2">&quot;titre_contextuel&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="PDFToChroma-233"><a href="#PDFToChroma-233"><span class="linenos">233</span></a>            <span class="s2">&quot;pdf_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">),</span>
</span><span id="PDFToChroma-234"><a href="#PDFToChroma-234"><span class="linenos">234</span></a>            <span class="s2">&quot;source_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="PDFToChroma-235"><a href="#PDFToChroma-235"><span class="linenos">235</span></a>            <span class="s2">&quot;access_level&quot;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="PDFToChroma-236"><a href="#PDFToChroma-236"><span class="linenos">236</span></a>            <span class="s2">&quot;document_type&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma-237"><a href="#PDFToChroma-237"><span class="linenos">237</span></a>            <span class="s2">&quot;access_indicator&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;PDF </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma-238"><a href="#PDFToChroma-238"><span class="linenos">238</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="PDFToChroma-239"><a href="#PDFToChroma-239"><span class="linenos">239</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma-240"><a href="#PDFToChroma-240"><span class="linenos">240</span></a>
</span><span id="PDFToChroma-241"><a href="#PDFToChroma-241"><span class="linenos">241</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PDFToChroma-242"><a href="#PDFToChroma-242"><span class="linenos">242</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="PDFToChroma-243"><a href="#PDFToChroma-243"><span class="linenos">243</span></a>
</span><span id="PDFToChroma-244"><a href="#PDFToChroma-244"><span class="linenos">244</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  JSON sauvé: </span><span class="si">{</span><span class="n">json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-245"><a href="#PDFToChroma-245"><span class="linenos">245</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Niveau d&#39;accès: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-246"><a href="#PDFToChroma-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">json_data</span>
</span><span id="PDFToChroma-247"><a href="#PDFToChroma-247"><span class="linenos">247</span></a>
</span><span id="PDFToChroma-248"><a href="#PDFToChroma-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ajouter_a_chromadb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
</span><span id="PDFToChroma-249"><a href="#PDFToChroma-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-250"><a href="#PDFToChroma-250"><span class="linenos">250</span></a><span class="sd">        Ajoute un document PDF et ses métadonnées à une collection ChromaDB. Cette méthode</span>
</span><span id="PDFToChroma-251"><a href="#PDFToChroma-251"><span class="linenos">251</span></a><span class="sd">        génère une description textuelle basée sur les données du document, crée un embedding</span>
</span><span id="PDFToChroma-252"><a href="#PDFToChroma-252"><span class="linenos">252</span></a><span class="sd">        avec un modèle d&#39;encodage fourni, et enregistre les métadonnées ainsi que le contenu</span>
</span><span id="PDFToChroma-253"><a href="#PDFToChroma-253"><span class="linenos">253</span></a><span class="sd">        associé dans la base de données.</span>
</span><span id="PDFToChroma-254"><a href="#PDFToChroma-254"><span class="linenos">254</span></a>
</span><span id="PDFToChroma-255"><a href="#PDFToChroma-255"><span class="linenos">255</span></a><span class="sd">        :param json_data: Un dictionnaire contenant les informations concernant le</span>
</span><span id="PDFToChroma-256"><a href="#PDFToChroma-256"><span class="linenos">256</span></a><span class="sd">            fichier PDF à traiter et à ajouter dans la base de données.</span>
</span><span id="PDFToChroma-257"><a href="#PDFToChroma-257"><span class="linenos">257</span></a><span class="sd">        :type json_data: dict</span>
</span><span id="PDFToChroma-258"><a href="#PDFToChroma-258"><span class="linenos">258</span></a><span class="sd">        :return: L&#39;identifiant unique (ID) généré pour le document ajouté dans ChromaDB.</span>
</span><span id="PDFToChroma-259"><a href="#PDFToChroma-259"><span class="linenos">259</span></a><span class="sd">        :rtype: str</span>
</span><span id="PDFToChroma-260"><a href="#PDFToChroma-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-261"><a href="#PDFToChroma-261"><span class="linenos">261</span></a>
</span><span id="PDFToChroma-262"><a href="#PDFToChroma-262"><span class="linenos">262</span></a>        <span class="c1"># Créer description pour la recherche</span>
</span><span id="PDFToChroma-263"><a href="#PDFToChroma-263"><span class="linenos">263</span></a>        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DOCUMENT PDF: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma-264"><a href="#PDFToChroma-264"><span class="linenos">264</span></a><span class="s2">TYPE: Document PDF</span>
</span><span id="PDFToChroma-265"><a href="#PDFToChroma-265"><span class="linenos">265</span></a><span class="s2">NIVEAU D&#39;ACCÈS: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma-266"><a href="#PDFToChroma-266"><span class="linenos">266</span></a><span class="s2">DOSSIER: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma-267"><a href="#PDFToChroma-267"><span class="linenos">267</span></a><span class="s2">CONTENU: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;resume_gemini&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-268"><a href="#PDFToChroma-268"><span class="linenos">268</span></a>
</span><span id="PDFToChroma-269"><a href="#PDFToChroma-269"><span class="linenos">269</span></a>        <span class="c1"># Générer embedding</span>
</span><span id="PDFToChroma-270"><a href="#PDFToChroma-270"><span class="linenos">270</span></a>        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">description</span><span class="p">])</span>
</span><span id="PDFToChroma-271"><a href="#PDFToChroma-271"><span class="linenos">271</span></a>
</span><span id="PDFToChroma-272"><a href="#PDFToChroma-272"><span class="linenos">272</span></a>        <span class="c1"># Métadonnées pour ChromaDB avec niveau d&#39;accès</span>
</span><span id="PDFToChroma-273"><a href="#PDFToChroma-273"><span class="linenos">273</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma-274"><a href="#PDFToChroma-274"><span class="linenos">274</span></a>            <span class="s1">&#39;fichier_source&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-275"><a href="#PDFToChroma-275"><span class="linenos">275</span></a>            <span class="s1">&#39;type_document&#39;</span><span class="p">:</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
</span><span id="PDFToChroma-276"><a href="#PDFToChroma-276"><span class="linenos">276</span></a>            <span class="s1">&#39;taille_fichier&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;taille_fichier&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-277"><a href="#PDFToChroma-277"><span class="linenos">277</span></a>            <span class="s1">&#39;pdf_path&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;pdf_path&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-278"><a href="#PDFToChroma-278"><span class="linenos">278</span></a>            <span class="s1">&#39;source_directory&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-279"><a href="#PDFToChroma-279"><span class="linenos">279</span></a>            <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-280"><a href="#PDFToChroma-280"><span class="linenos">280</span></a>            <span class="s1">&#39;document_type&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;document_type&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-281"><a href="#PDFToChroma-281"><span class="linenos">281</span></a>            <span class="s1">&#39;access_indicator&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_indicator&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-282"><a href="#PDFToChroma-282"><span class="linenos">282</span></a>            <span class="s1">&#39;titre_contextuel&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;titre_contextuel&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-283"><a href="#PDFToChroma-283"><span class="linenos">283</span></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-284"><a href="#PDFToChroma-284"><span class="linenos">284</span></a>            <span class="s1">&#39;description_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="PDFToChroma-285"><a href="#PDFToChroma-285"><span class="linenos">285</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma-286"><a href="#PDFToChroma-286"><span class="linenos">286</span></a>
</span><span id="PDFToChroma-287"><a href="#PDFToChroma-287"><span class="linenos">287</span></a>        <span class="c1"># Ajouter à la collection</span>
</span><span id="PDFToChroma-288"><a href="#PDFToChroma-288"><span class="linenos">288</span></a>        <span class="n">doc_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="PDFToChroma-289"><a href="#PDFToChroma-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="PDFToChroma-290"><a href="#PDFToChroma-290"><span class="linenos">290</span></a>            <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span>
</span><span id="PDFToChroma-291"><a href="#PDFToChroma-291"><span class="linenos">291</span></a>            <span class="n">embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="PDFToChroma-292"><a href="#PDFToChroma-292"><span class="linenos">292</span></a>            <span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="n">description</span><span class="p">],</span>
</span><span id="PDFToChroma-293"><a href="#PDFToChroma-293"><span class="linenos">293</span></a>            <span class="n">metadatas</span><span class="o">=</span><span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
</span><span id="PDFToChroma-294"><a href="#PDFToChroma-294"><span class="linenos">294</span></a>        <span class="p">)</span>
</span><span id="PDFToChroma-295"><a href="#PDFToChroma-295"><span class="linenos">295</span></a>
</span><span id="PDFToChroma-296"><a href="#PDFToChroma-296"><span class="linenos">296</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ajouté à ChromaDB: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> (niveau: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-297"><a href="#PDFToChroma-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="n">doc_id</span>
</span><span id="PDFToChroma-298"><a href="#PDFToChroma-298"><span class="linenos">298</span></a>
</span><span id="PDFToChroma-299"><a href="#PDFToChroma-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_tous_les_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="PDFToChroma-300"><a href="#PDFToChroma-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-301"><a href="#PDFToChroma-301"><span class="linenos">301</span></a><span class="sd">        Traite tous les fichiers PDF dans un dossier donné, génère des résumés,</span>
</span><span id="PDFToChroma-302"><a href="#PDFToChroma-302"><span class="linenos">302</span></a><span class="sd">        et les stocke dans une base de données avec un niveau d&#39;accès spécifié.</span>
</span><span id="PDFToChroma-303"><a href="#PDFToChroma-303"><span class="linenos">303</span></a><span class="sd">        Cette méthode utilise un flux de traitement qui comprend la recherche des PDF,</span>
</span><span id="PDFToChroma-304"><a href="#PDFToChroma-304"><span class="linenos">304</span></a><span class="sd">        leur analyse via un outil de résumé, la création de métadonnées adéquates et</span>
</span><span id="PDFToChroma-305"><a href="#PDFToChroma-305"><span class="linenos">305</span></a><span class="sd">        l&#39;ajout à une base de données.</span>
</span><span id="PDFToChroma-306"><a href="#PDFToChroma-306"><span class="linenos">306</span></a>
</span><span id="PDFToChroma-307"><a href="#PDFToChroma-307"><span class="linenos">307</span></a><span class="sd">        Le traitement effectue les étapes suivantes :</span>
</span><span id="PDFToChroma-308"><a href="#PDFToChroma-308"><span class="linenos">308</span></a><span class="sd">        - Recherche des PDF dans un dossier, avec identification de leur niveau d&#39;accès.</span>
</span><span id="PDFToChroma-309"><a href="#PDFToChroma-309"><span class="linenos">309</span></a><span class="sd">        - Création de résumés pour chaque fichier PDF.</span>
</span><span id="PDFToChroma-310"><a href="#PDFToChroma-310"><span class="linenos">310</span></a><span class="sd">        - Création de documents JSON contenant les résumés et leurs métadonnées associées.</span>
</span><span id="PDFToChroma-311"><a href="#PDFToChroma-311"><span class="linenos">311</span></a><span class="sd">        - Insertion des documents JSON dans une collection d&#39;une base de données.</span>
</span><span id="PDFToChroma-312"><a href="#PDFToChroma-312"><span class="linenos">312</span></a>
</span><span id="PDFToChroma-313"><a href="#PDFToChroma-313"><span class="linenos">313</span></a><span class="sd">        Cette méthode fournit un résumé détaillé sur les statistiques des fichiers PDF analysés</span>
</span><span id="PDFToChroma-314"><a href="#PDFToChroma-314"><span class="linenos">314</span></a><span class="sd">        et donne un aperçu final des données ajoutées dans la base.</span>
</span><span id="PDFToChroma-315"><a href="#PDFToChroma-315"><span class="linenos">315</span></a>
</span><span id="PDFToChroma-316"><a href="#PDFToChroma-316"><span class="linenos">316</span></a><span class="sd">        :param dossier: Chemin du dossier contenant les fichiers PDF à traiter. Par défaut, &quot;data&quot;.</span>
</span><span id="PDFToChroma-317"><a href="#PDFToChroma-317"><span class="linenos">317</span></a><span class="sd">        :type dossier: str</span>
</span><span id="PDFToChroma-318"><a href="#PDFToChroma-318"><span class="linenos">318</span></a><span class="sd">        :return: Aucune valeur n&#39;est retournée. Les opérations de traitement sont réalisées en place.</span>
</span><span id="PDFToChroma-319"><a href="#PDFToChroma-319"><span class="linenos">319</span></a><span class="sd">        :rtype: None</span>
</span><span id="PDFToChroma-320"><a href="#PDFToChroma-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-321"><a href="#PDFToChroma-321"><span class="linenos">321</span></a>
</span><span id="PDFToChroma-322"><a href="#PDFToChroma-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== DÉBUT DU TRAITEMENT ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-323"><a href="#PDFToChroma-323"><span class="linenos">323</span></a>
</span><span id="PDFToChroma-324"><a href="#PDFToChroma-324"><span class="linenos">324</span></a>        <span class="c1"># 1. Trouver les PDFs avec leurs niveaux d&#39;accès</span>
</span><span id="PDFToChroma-325"><a href="#PDFToChroma-325"><span class="linenos">325</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trouver_pdfs</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="PDFToChroma-326"><a href="#PDFToChroma-326"><span class="linenos">326</span></a>
</span><span id="PDFToChroma-327"><a href="#PDFToChroma-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma-328"><a href="#PDFToChroma-328"><span class="linenos">328</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun PDF trouvé&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-329"><a href="#PDFToChroma-329"><span class="linenos">329</span></a>            <span class="k">return</span>
</span><span id="PDFToChroma-330"><a href="#PDFToChroma-330"><span class="linenos">330</span></a>
</span><span id="PDFToChroma-331"><a href="#PDFToChroma-331"><span class="linenos">331</span></a>        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PDFToChroma-332"><a href="#PDFToChroma-332"><span class="linenos">332</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma-333"><a href="#PDFToChroma-333"><span class="linenos">333</span></a>
</span><span id="PDFToChroma-334"><a href="#PDFToChroma-334"><span class="linenos">334</span></a>        <span class="c1"># 2. Traiter chaque PDF</span>
</span><span id="PDFToChroma-335"><a href="#PDFToChroma-335"><span class="linenos">335</span></a>        <span class="k">for</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma-336"><a href="#PDFToChroma-336"><span class="linenos">336</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">) ---&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-337"><a href="#PDFToChroma-337"><span class="linenos">337</span></a>
</span><span id="PDFToChroma-338"><a href="#PDFToChroma-338"><span class="linenos">338</span></a>            <span class="c1"># Résumé avec Gemini</span>
</span><span id="PDFToChroma-339"><a href="#PDFToChroma-339"><span class="linenos">339</span></a>            <span class="n">resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma-340"><a href="#PDFToChroma-340"><span class="linenos">340</span></a>
</span><span id="PDFToChroma-341"><a href="#PDFToChroma-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">resume</span><span class="p">:</span>
</span><span id="PDFToChroma-342"><a href="#PDFToChroma-342"><span class="linenos">342</span></a>                <span class="c1"># Créer JSON avec niveau d&#39;accès</span>
</span><span id="PDFToChroma-343"><a href="#PDFToChroma-343"><span class="linenos">343</span></a>                <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_json_resume</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume</span><span class="p">)</span>
</span><span id="PDFToChroma-344"><a href="#PDFToChroma-344"><span class="linenos">344</span></a>
</span><span id="PDFToChroma-345"><a href="#PDFToChroma-345"><span class="linenos">345</span></a>                <span class="c1"># Ajouter à ChromaDB</span>
</span><span id="PDFToChroma-346"><a href="#PDFToChroma-346"><span class="linenos">346</span></a>                <span class="n">doc_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ajouter_a_chromadb</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="PDFToChroma-347"><a href="#PDFToChroma-347"><span class="linenos">347</span></a>
</span><span id="PDFToChroma-348"><a href="#PDFToChroma-348"><span class="linenos">348</span></a>                <span class="k">if</span> <span class="n">doc_id</span><span class="p">:</span>
</span><span id="PDFToChroma-349"><a href="#PDFToChroma-349"><span class="linenos">349</span></a>                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-350"><a href="#PDFToChroma-350"><span class="linenos">350</span></a>                    <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-351"><a href="#PDFToChroma-351"><span class="linenos">351</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Succès&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-352"><a href="#PDFToChroma-352"><span class="linenos">352</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma-353"><a href="#PDFToChroma-353"><span class="linenos">353</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Échec&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-354"><a href="#PDFToChroma-354"><span class="linenos">354</span></a>
</span><span id="PDFToChroma-355"><a href="#PDFToChroma-355"><span class="linenos">355</span></a>        <span class="c1"># 3. Résultats finaux</span>
</span><span id="PDFToChroma-356"><a href="#PDFToChroma-356"><span class="linenos">356</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== RÉSULTATS ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-357"><a href="#PDFToChroma-357"><span class="linenos">357</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PDFs traités avec succès: </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-358"><a href="#PDFToChroma-358"><span class="linenos">358</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès traités:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-359"><a href="#PDFToChroma-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma-360"><a href="#PDFToChroma-360"><span class="linenos">360</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-361"><a href="#PDFToChroma-361"><span class="linenos">361</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection ChromaDB: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents total&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-362"><a href="#PDFToChroma-362"><span class="linenos">362</span></a>
</span><span id="PDFToChroma-363"><a href="#PDFToChroma-363"><span class="linenos">363</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rechercher_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="PDFToChroma-364"><a href="#PDFToChroma-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-365"><a href="#PDFToChroma-365"><span class="linenos">365</span></a><span class="sd">        Rechercher des fichiers PDF dans une collection en fonction d&#39;une requête donnée,</span>
</span><span id="PDFToChroma-366"><a href="#PDFToChroma-366"><span class="linenos">366</span></a><span class="sd">        du rôle utilisateur et du nombre de résultats souhaités. Les résultats retournés</span>
</span><span id="PDFToChroma-367"><a href="#PDFToChroma-367"><span class="linenos">367</span></a><span class="sd">        sont filtrés en fonction du niveau d&#39;accès autorisé pour le rôle spécifié.</span>
</span><span id="PDFToChroma-368"><a href="#PDFToChroma-368"><span class="linenos">368</span></a>
</span><span id="PDFToChroma-369"><a href="#PDFToChroma-369"><span class="linenos">369</span></a><span class="sd">        :param query: La requête de recherche sous forme de texte.</span>
</span><span id="PDFToChroma-370"><a href="#PDFToChroma-370"><span class="linenos">370</span></a><span class="sd">        :type query: str</span>
</span><span id="PDFToChroma-371"><a href="#PDFToChroma-371"><span class="linenos">371</span></a><span class="sd">        :param user_role: Le rôle de l&#39;utilisateur effectuant la recherche (public, internal,</span>
</span><span id="PDFToChroma-372"><a href="#PDFToChroma-372"><span class="linenos">372</span></a><span class="sd">            admin). Par défaut, il est défini sur &quot;public&quot;.</span>
</span><span id="PDFToChroma-373"><a href="#PDFToChroma-373"><span class="linenos">373</span></a><span class="sd">        :type user_role: str</span>
</span><span id="PDFToChroma-374"><a href="#PDFToChroma-374"><span class="linenos">374</span></a><span class="sd">        :param n_results: Le nombre de résultats à retourner après filtrage basé sur le</span>
</span><span id="PDFToChroma-375"><a href="#PDFToChroma-375"><span class="linenos">375</span></a><span class="sd">            rôle utilisateur. Par défaut, 5 résultats sont retournés.</span>
</span><span id="PDFToChroma-376"><a href="#PDFToChroma-376"><span class="linenos">376</span></a><span class="sd">        :type n_results: int</span>
</span><span id="PDFToChroma-377"><a href="#PDFToChroma-377"><span class="linenos">377</span></a><span class="sd">        :return: Une liste des résultats filtrés contenant des informations sur les fichiers</span>
</span><span id="PDFToChroma-378"><a href="#PDFToChroma-378"><span class="linenos">378</span></a><span class="sd">            trouvés, telles que le nom du fichier, le type du document, le niveau</span>
</span><span id="PDFToChroma-379"><a href="#PDFToChroma-379"><span class="linenos">379</span></a><span class="sd">            d&#39;accès, la pertinence et le dossier source. Si aucun résultat n&#39;est trouvé,</span>
</span><span id="PDFToChroma-380"><a href="#PDFToChroma-380"><span class="linenos">380</span></a><span class="sd">            retourne une liste vide.</span>
</span><span id="PDFToChroma-381"><a href="#PDFToChroma-381"><span class="linenos">381</span></a><span class="sd">        :rtype: list[dict]</span>
</span><span id="PDFToChroma-382"><a href="#PDFToChroma-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-383"><a href="#PDFToChroma-383"><span class="linenos">383</span></a>        <span class="c1"># Mapping des rôles utilisateur vers les niveaux d&#39;accès autorisés</span>
</span><span id="PDFToChroma-384"><a href="#PDFToChroma-384"><span class="linenos">384</span></a>        <span class="n">roles_access</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma-385"><a href="#PDFToChroma-385"><span class="linenos">385</span></a>            <span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-386"><a href="#PDFToChroma-386"><span class="linenos">386</span></a>            <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma-387"><a href="#PDFToChroma-387"><span class="linenos">387</span></a>            <span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">]</span>
</span><span id="PDFToChroma-388"><a href="#PDFToChroma-388"><span class="linenos">388</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma-389"><a href="#PDFToChroma-389"><span class="linenos">389</span></a>
</span><span id="PDFToChroma-390"><a href="#PDFToChroma-390"><span class="linenos">390</span></a>        <span class="n">niveaux_autorises</span> <span class="o">=</span> <span class="n">roles_access</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">])</span>
</span><span id="PDFToChroma-391"><a href="#PDFToChroma-391"><span class="linenos">391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche pour rôle &#39;</span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">&#39; - Niveaux autorisés: </span><span class="si">{</span><span class="n">niveaux_autorises</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-392"><a href="#PDFToChroma-392"><span class="linenos">392</span></a>
</span><span id="PDFToChroma-393"><a href="#PDFToChroma-393"><span class="linenos">393</span></a>        <span class="c1"># Générer embedding de la requête</span>
</span><span id="PDFToChroma-394"><a href="#PDFToChroma-394"><span class="linenos">394</span></a>        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">query</span><span class="p">])</span>
</span><span id="PDFToChroma-395"><a href="#PDFToChroma-395"><span class="linenos">395</span></a>
</span><span id="PDFToChroma-396"><a href="#PDFToChroma-396"><span class="linenos">396</span></a>        <span class="c1"># Rechercher (plus de résultats pour permettre le filtrage)</span>
</span><span id="PDFToChroma-397"><a href="#PDFToChroma-397"><span class="linenos">397</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="PDFToChroma-398"><a href="#PDFToChroma-398"><span class="linenos">398</span></a>            <span class="n">query_embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="PDFToChroma-399"><a href="#PDFToChroma-399"><span class="linenos">399</span></a>            <span class="n">n_results</span><span class="o">=</span><span class="n">n_results</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Plus de résultats pour filtrage</span>
</span><span id="PDFToChroma-400"><a href="#PDFToChroma-400"><span class="linenos">400</span></a>            <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="s1">&#39;metadatas&#39;</span><span class="p">,</span> <span class="s1">&#39;distances&#39;</span><span class="p">]</span>
</span><span id="PDFToChroma-401"><a href="#PDFToChroma-401"><span class="linenos">401</span></a>        <span class="p">)</span>
</span><span id="PDFToChroma-402"><a href="#PDFToChroma-402"><span class="linenos">402</span></a>
</span><span id="PDFToChroma-403"><a href="#PDFToChroma-403"><span class="linenos">403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Résultats pour &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; (rôle: </span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-404"><a href="#PDFToChroma-404"><span class="linenos">404</span></a>
</span><span id="PDFToChroma-405"><a href="#PDFToChroma-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="PDFToChroma-406"><a href="#PDFToChroma-406"><span class="linenos">406</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun résultat trouvé&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-407"><a href="#PDFToChroma-407"><span class="linenos">407</span></a>            <span class="k">return</span>
</span><span id="PDFToChroma-408"><a href="#PDFToChroma-408"><span class="linenos">408</span></a>
</span><span id="PDFToChroma-409"><a href="#PDFToChroma-409"><span class="linenos">409</span></a>        <span class="n">resultats_filtres</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PDFToChroma-410"><a href="#PDFToChroma-410"><span class="linenos">410</span></a>
</span><span id="PDFToChroma-411"><a href="#PDFToChroma-411"><span class="linenos">411</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
</span><span id="PDFToChroma-412"><a href="#PDFToChroma-412"><span class="linenos">412</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="PDFToChroma-413"><a href="#PDFToChroma-413"><span class="linenos">413</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma-414"><a href="#PDFToChroma-414"><span class="linenos">414</span></a>
</span><span id="PDFToChroma-415"><a href="#PDFToChroma-415"><span class="linenos">415</span></a>            <span class="c1"># Filtrer selon le rôle utilisateur</span>
</span><span id="PDFToChroma-416"><a href="#PDFToChroma-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">niveaux_autorises</span><span class="p">:</span>
</span><span id="PDFToChroma-417"><a href="#PDFToChroma-417"><span class="linenos">417</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="PDFToChroma-418"><a href="#PDFToChroma-418"><span class="linenos">418</span></a>
</span><span id="PDFToChroma-419"><a href="#PDFToChroma-419"><span class="linenos">419</span></a>                <span class="n">resultats_filtres</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PDFToChroma-420"><a href="#PDFToChroma-420"><span class="linenos">420</span></a>                    <span class="s1">&#39;fichier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
</span><span id="PDFToChroma-421"><a href="#PDFToChroma-421"><span class="linenos">421</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">),</span>
</span><span id="PDFToChroma-422"><a href="#PDFToChroma-422"><span class="linenos">422</span></a>                    <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="PDFToChroma-423"><a href="#PDFToChroma-423"><span class="linenos">423</span></a>                    <span class="s1">&#39;pertinence&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance</span><span class="p">,</span>
</span><span id="PDFToChroma-424"><a href="#PDFToChroma-424"><span class="linenos">424</span></a>                    <span class="s1">&#39;dossier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma-425"><a href="#PDFToChroma-425"><span class="linenos">425</span></a>                <span class="p">})</span>
</span><span id="PDFToChroma-426"><a href="#PDFToChroma-426"><span class="linenos">426</span></a>
</span><span id="PDFToChroma-427"><a href="#PDFToChroma-427"><span class="linenos">427</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n_results</span><span class="p">:</span>
</span><span id="PDFToChroma-428"><a href="#PDFToChroma-428"><span class="linenos">428</span></a>                    <span class="k">break</span>
</span><span id="PDFToChroma-429"><a href="#PDFToChroma-429"><span class="linenos">429</span></a>
</span><span id="PDFToChroma-430"><a href="#PDFToChroma-430"><span class="linenos">430</span></a>        <span class="c1"># Afficher les résultats filtrés</span>
</span><span id="PDFToChroma-431"><a href="#PDFToChroma-431"><span class="linenos">431</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">resultat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="PDFToChroma-432"><a href="#PDFToChroma-432"><span class="linenos">432</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;fichier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-433"><a href="#PDFToChroma-433"><span class="linenos">433</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Type: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> | Niveau: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-434"><a href="#PDFToChroma-434"><span class="linenos">434</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Dossier: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;dossier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-435"><a href="#PDFToChroma-435"><span class="linenos">435</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Pertinence: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;pertinence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-436"><a href="#PDFToChroma-436"><span class="linenos">436</span></a>            <span class="nb">print</span><span class="p">()</span>
</span><span id="PDFToChroma-437"><a href="#PDFToChroma-437"><span class="linenos">437</span></a>
</span><span id="PDFToChroma-438"><a href="#PDFToChroma-438"><span class="linenos">438</span></a>        <span class="k">return</span> <span class="n">resultats_filtres</span>
</span><span id="PDFToChroma-439"><a href="#PDFToChroma-439"><span class="linenos">439</span></a>
</span><span id="PDFToChroma-440"><a href="#PDFToChroma-440"><span class="linenos">440</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma-441"><a href="#PDFToChroma-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-442"><a href="#PDFToChroma-442"><span class="linenos">442</span></a><span class="sd">        Calcule et affiche des statistiques sur une collection de documents.</span>
</span><span id="PDFToChroma-443"><a href="#PDFToChroma-443"><span class="linenos">443</span></a>
</span><span id="PDFToChroma-444"><a href="#PDFToChroma-444"><span class="linenos">444</span></a><span class="sd">        Cette méthode permet de collecter des statistiques sur la répartition des types</span>
</span><span id="PDFToChroma-445"><a href="#PDFToChroma-445"><span class="linenos">445</span></a><span class="sd">        de documents et les niveaux d&#39;accès associés dans une collection donnée.</span>
</span><span id="PDFToChroma-446"><a href="#PDFToChroma-446"><span class="linenos">446</span></a><span class="sd">        Les informations sont extraites des métadonnées des documents.</span>
</span><span id="PDFToChroma-447"><a href="#PDFToChroma-447"><span class="linenos">447</span></a>
</span><span id="PDFToChroma-448"><a href="#PDFToChroma-448"><span class="linenos">448</span></a><span class="sd">        :return: Rien. Cette méthode imprime directement les statistiques dans la console.</span>
</span><span id="PDFToChroma-449"><a href="#PDFToChroma-449"><span class="linenos">449</span></a><span class="sd">        :rtype: None</span>
</span><span id="PDFToChroma-450"><a href="#PDFToChroma-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-451"><a href="#PDFToChroma-451"><span class="linenos">451</span></a>
</span><span id="PDFToChroma-452"><a href="#PDFToChroma-452"><span class="linenos">452</span></a>        <span class="c1"># Récupérer tous les documents</span>
</span><span id="PDFToChroma-453"><a href="#PDFToChroma-453"><span class="linenos">453</span></a>        <span class="n">all_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">])</span>
</span><span id="PDFToChroma-454"><a href="#PDFToChroma-454"><span class="linenos">454</span></a>
</span><span id="PDFToChroma-455"><a href="#PDFToChroma-455"><span class="linenos">455</span></a>        <span class="c1"># Compteurs</span>
</span><span id="PDFToChroma-456"><a href="#PDFToChroma-456"><span class="linenos">456</span></a>        <span class="n">stats_par_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tableau&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma-457"><a href="#PDFToChroma-457"><span class="linenos">457</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;non_defini&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma-458"><a href="#PDFToChroma-458"><span class="linenos">458</span></a>
</span><span id="PDFToChroma-459"><a href="#PDFToChroma-459"><span class="linenos">459</span></a>        <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma-460"><a href="#PDFToChroma-460"><span class="linenos">460</span></a>            <span class="c1"># Type de document</span>
</span><span id="PDFToChroma-461"><a href="#PDFToChroma-461"><span class="linenos">461</span></a>            <span class="n">doc_type</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma-462"><a href="#PDFToChroma-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">doc_type</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="PDFToChroma-463"><a href="#PDFToChroma-463"><span class="linenos">463</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-464"><a href="#PDFToChroma-464"><span class="linenos">464</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma-465"><a href="#PDFToChroma-465"><span class="linenos">465</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;tableau&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-466"><a href="#PDFToChroma-466"><span class="linenos">466</span></a>
</span><span id="PDFToChroma-467"><a href="#PDFToChroma-467"><span class="linenos">467</span></a>            <span class="c1"># Niveau d&#39;accès</span>
</span><span id="PDFToChroma-468"><a href="#PDFToChroma-468"><span class="linenos">468</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma-469"><a href="#PDFToChroma-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="p">:</span>
</span><span id="PDFToChroma-470"><a href="#PDFToChroma-470"><span class="linenos">470</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-471"><a href="#PDFToChroma-471"><span class="linenos">471</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma-472"><a href="#PDFToChroma-472"><span class="linenos">472</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="s1">&#39;non_defini&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma-473"><a href="#PDFToChroma-473"><span class="linenos">473</span></a>
</span><span id="PDFToChroma-474"><a href="#PDFToChroma-474"><span class="linenos">474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== STATISTIQUES COLLECTION ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-475"><a href="#PDFToChroma-475"><span class="linenos">475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total documents: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-476"><a href="#PDFToChroma-476"><span class="linenos">476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par type:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-477"><a href="#PDFToChroma-477"><span class="linenos">477</span></a>        <span class="k">for</span> <span class="n">type_doc</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma-478"><a href="#PDFToChroma-478"><span class="linenos">478</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">type_doc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-479"><a href="#PDFToChroma-479"><span class="linenos">479</span></a>
</span><span id="PDFToChroma-480"><a href="#PDFToChroma-480"><span class="linenos">480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-481"><a href="#PDFToChroma-481"><span class="linenos">481</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma-482"><a href="#PDFToChroma-482"><span class="linenos">482</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-483"><a href="#PDFToChroma-483"><span class="linenos">483</span></a>
</span><span id="PDFToChroma-484"><a href="#PDFToChroma-484"><span class="linenos">484</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tester_acces_par_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma-485"><a href="#PDFToChroma-485"><span class="linenos">485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma-486"><a href="#PDFToChroma-486"><span class="linenos">486</span></a><span class="sd">        Effectue un test des niveaux d&#39;accès à une fonctionnalité de recherche de PDF selon</span>
</span><span id="PDFToChroma-487"><a href="#PDFToChroma-487"><span class="linenos">487</span></a><span class="sd">        des rôles spécifiques.</span>
</span><span id="PDFToChroma-488"><a href="#PDFToChroma-488"><span class="linenos">488</span></a>
</span><span id="PDFToChroma-489"><a href="#PDFToChroma-489"><span class="linenos">489</span></a><span class="sd">        Le test est effectué pour les rôles suivants : &#39;public&#39;, &#39;internal&#39; et &#39;admin&#39;.</span>
</span><span id="PDFToChroma-490"><a href="#PDFToChroma-490"><span class="linenos">490</span></a><span class="sd">        Pour chacun de ces rôles, une recherche est réalisée avec un mot-clé donné, et les</span>
</span><span id="PDFToChroma-491"><a href="#PDFToChroma-491"><span class="linenos">491</span></a><span class="sd">        résultats sont imprimés pour inspection. Cette méthode sert à évaluer si les restrictions</span>
</span><span id="PDFToChroma-492"><a href="#PDFToChroma-492"><span class="linenos">492</span></a><span class="sd">        d&#39;accès basées sur les rôles fonctionnent correctement.</span>
</span><span id="PDFToChroma-493"><a href="#PDFToChroma-493"><span class="linenos">493</span></a>
</span><span id="PDFToChroma-494"><a href="#PDFToChroma-494"><span class="linenos">494</span></a><span class="sd">        :param query_test: La chaîne de recherche utilisée pour tester la fonctionnalité.</span>
</span><span id="PDFToChroma-495"><a href="#PDFToChroma-495"><span class="linenos">495</span></a><span class="sd">        :type query_test: str</span>
</span><span id="PDFToChroma-496"><a href="#PDFToChroma-496"><span class="linenos">496</span></a>
</span><span id="PDFToChroma-497"><a href="#PDFToChroma-497"><span class="linenos">497</span></a><span class="sd">        :return: Aucun retour. Les résultats sont affichés dans la sortie standard.</span>
</span><span id="PDFToChroma-498"><a href="#PDFToChroma-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma-499"><a href="#PDFToChroma-499"><span class="linenos">499</span></a>        <span class="n">query_test</span> <span class="o">=</span> <span class="s2">&quot;rapport&quot;</span>
</span><span id="PDFToChroma-500"><a href="#PDFToChroma-500"><span class="linenos">500</span></a>
</span><span id="PDFToChroma-501"><a href="#PDFToChroma-501"><span class="linenos">501</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== TEST DES NIVEAUX D&#39;ACCÈS ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-502"><a href="#PDFToChroma-502"><span class="linenos">502</span></a>
</span><span id="PDFToChroma-503"><a href="#PDFToChroma-503"><span class="linenos">503</span></a>        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma-504"><a href="#PDFToChroma-504"><span class="linenos">504</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Test pour rôle: </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma-505"><a href="#PDFToChroma-505"><span class="linenos">505</span></a>            <span class="n">resultats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rechercher_pdfs</span><span class="p">(</span><span class="n">query_test</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cette classe est conçue pour traiter les documents PDF afin de déterminer leur
niveau d'accès, générer des résumés à l'aide d'une API Gemini et les ajouter à
une base de données existante sous forme de vecteurs d'embedding.</p>

<p>La classe facilite également la gestion des contenus PDF au sein d'une
collection ChromaDB, tout en créant des fichiers JSON structurés pour chaque document.</p>

<p>:ivar client: Instance du client utilisé pour communiquer avec l'API Gemini.
:ivar chroma_client: Instance du client persistant pour accéder à ChromaDB.
:ivar collection: Collection ChromaDB utilisée pour enregistrer les données liées aux documents PDF.
:ivar embedding_model: Modèle utilisé pour générer des embeddings de texte basés sur le contenu des documents.</p>
</div>


                            <div id="PDFToChroma.__init__" class="classattr">
                                        <input id="PDFToChroma.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PDFToChroma</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="PDFToChroma.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.__init__-33"><a href="#PDFToChroma.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma.__init__-34"><a href="#PDFToChroma.__init__-34"><span class="linenos">34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.__init__-35"><a href="#PDFToChroma.__init__-35"><span class="linenos">35</span></a><span class="sd">        Cette classe configure et initialise les composants nécessaires pour un chatbot.</span>
</span><span id="PDFToChroma.__init__-36"><a href="#PDFToChroma.__init__-36"><span class="linenos">36</span></a><span class="sd">        Elle est responsable de la configuration du client Gemini, de l&#39;accès à ChromaDB,</span>
</span><span id="PDFToChroma.__init__-37"><a href="#PDFToChroma.__init__-37"><span class="linenos">37</span></a><span class="sd">        et de l&#39;initialisation du modèle d&#39;embeddings de phrases.</span>
</span><span id="PDFToChroma.__init__-38"><a href="#PDFToChroma.__init__-38"><span class="linenos">38</span></a>
</span><span id="PDFToChroma.__init__-39"><a href="#PDFToChroma.__init__-39"><span class="linenos">39</span></a><span class="sd">        Attributs</span>
</span><span id="PDFToChroma.__init__-40"><a href="#PDFToChroma.__init__-40"><span class="linenos">40</span></a><span class="sd">        ---------</span>
</span><span id="PDFToChroma.__init__-41"><a href="#PDFToChroma.__init__-41"><span class="linenos">41</span></a><span class="sd">        client : genai.Client</span>
</span><span id="PDFToChroma.__init__-42"><a href="#PDFToChroma.__init__-42"><span class="linenos">42</span></a><span class="sd">            Un client configuré pour interagir avec le service Gemini.</span>
</span><span id="PDFToChroma.__init__-43"><a href="#PDFToChroma.__init__-43"><span class="linenos">43</span></a><span class="sd">        chroma_client : chromadb.PersistentClient</span>
</span><span id="PDFToChroma.__init__-44"><a href="#PDFToChroma.__init__-44"><span class="linenos">44</span></a><span class="sd">            Client configuré pour l&#39;accès à une base ChromaDB persistante.</span>
</span><span id="PDFToChroma.__init__-45"><a href="#PDFToChroma.__init__-45"><span class="linenos">45</span></a><span class="sd">        collection : chromadb.Collection</span>
</span><span id="PDFToChroma.__init__-46"><a href="#PDFToChroma.__init__-46"><span class="linenos">46</span></a><span class="sd">            Collection accessible dans ChromaDB contenant les données existantes.</span>
</span><span id="PDFToChroma.__init__-47"><a href="#PDFToChroma.__init__-47"><span class="linenos">47</span></a><span class="sd">        embedding_model : SentenceTransformer</span>
</span><span id="PDFToChroma.__init__-48"><a href="#PDFToChroma.__init__-48"><span class="linenos">48</span></a><span class="sd">            Modèle utilisé pour générer des embeddings à partir de phrases.</span>
</span><span id="PDFToChroma.__init__-49"><a href="#PDFToChroma.__init__-49"><span class="linenos">49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.__init__-50"><a href="#PDFToChroma.__init__-50"><span class="linenos">50</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/home/aissa/Bureau/Projet_Chatbot/Chatbot_AMDIE/chatbot_maroc/backend_python&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.__init__-51"><a href="#PDFToChroma.__init__-51"><span class="linenos">51</span></a>        <span class="c1"># Configuration Gemini</span>
</span><span id="PDFToChroma.__init__-52"><a href="#PDFToChroma.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span><span id="PDFToChroma.__init__-53"><a href="#PDFToChroma.__init__-53"><span class="linenos">53</span></a>
</span><span id="PDFToChroma.__init__-54"><a href="#PDFToChroma.__init__-54"><span class="linenos">54</span></a>        <span class="c1"># Configuration ChromaDB - collection existante</span>
</span><span id="PDFToChroma.__init__-55"><a href="#PDFToChroma.__init__-55"><span class="linenos">55</span></a>        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;RAG_DB_PATH&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.__init__-56"><a href="#PDFToChroma.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>
</span><span id="PDFToChroma.__init__-57"><a href="#PDFToChroma.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;tableaux_maroc&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.__init__-58"><a href="#PDFToChroma.__init__-58"><span class="linenos">58</span></a>
</span><span id="PDFToChroma.__init__-59"><a href="#PDFToChroma.__init__-59"><span class="linenos">59</span></a>        <span class="c1"># Modèle d&#39;embeddings</span>
</span><span id="PDFToChroma.__init__-60"><a href="#PDFToChroma.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.__init__-61"><a href="#PDFToChroma.__init__-61"><span class="linenos">61</span></a>
</span><span id="PDFToChroma.__init__-62"><a href="#PDFToChroma.__init__-62"><span class="linenos">62</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection tableaux_maroc: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents existants&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cette classe configure et initialise les composants nécessaires pour un chatbot.
Elle est responsable de la configuration du client Gemini, de l'accès à ChromaDB,
et de l'initialisation du modèle d'embeddings de phrases.</p>

<h2 id="attributs">Attributs</h2>

<p>client : genai.Client
    Un client configuré pour interagir avec le service Gemini.
chroma_client : chromadb.PersistentClient
    Client configuré pour l'accès à une base ChromaDB persistante.
collection : chromadb.Collection
    Collection accessible dans ChromaDB contenant les données existantes.
embedding_model : SentenceTransformer
    Modèle utilisé pour générer des embeddings à partir de phrases.</p>
</div>


                            </div>
                            <div id="PDFToChroma.client" class="classattr">
                                <div class="attr variable">
            <span class="name">client</span>

        
    </div>
    <a class="headerlink" href="#PDFToChroma.client"></a>
    
    

                            </div>
                            <div id="PDFToChroma.chroma_client" class="classattr">
                                <div class="attr variable">
            <span class="name">chroma_client</span>

        
    </div>
    <a class="headerlink" href="#PDFToChroma.chroma_client"></a>
    
    

                            </div>
                            <div id="PDFToChroma.collection" class="classattr">
                                <div class="attr variable">
            <span class="name">collection</span>

        
    </div>
    <a class="headerlink" href="#PDFToChroma.collection"></a>
    
    

                            </div>
                            <div id="PDFToChroma.embedding_model" class="classattr">
                                <div class="attr variable">
            <span class="name">embedding_model</span>

        
    </div>
    <a class="headerlink" href="#PDFToChroma.embedding_model"></a>
    
    

                            </div>
                            <div id="PDFToChroma.trouver_pdfs" class="classattr">
                                        <input id="PDFToChroma.trouver_pdfs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trouver_pdfs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dossier</span><span class="o">=</span><span class="s1">&#39;data&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.trouver_pdfs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.trouver_pdfs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.trouver_pdfs-122"><a href="#PDFToChroma.trouver_pdfs-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">trouver_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="PDFToChroma.trouver_pdfs-123"><a href="#PDFToChroma.trouver_pdfs-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.trouver_pdfs-124"><a href="#PDFToChroma.trouver_pdfs-124"><span class="linenos">124</span></a><span class="sd">        Analyse un dossier donné et recherche récursivement tous les fichiers PDF</span>
</span><span id="PDFToChroma.trouver_pdfs-125"><a href="#PDFToChroma.trouver_pdfs-125"><span class="linenos">125</span></a><span class="sd">        dans celui-ci et ses sous-dossiers. La fonction détermine également un</span>
</span><span id="PDFToChroma.trouver_pdfs-126"><a href="#PDFToChroma.trouver_pdfs-126"><span class="linenos">126</span></a><span class="sd">        niveau d&#39;accès pour chaque fichier PDF trouvé. Les résultats incluent le</span>
</span><span id="PDFToChroma.trouver_pdfs-127"><a href="#PDFToChroma.trouver_pdfs-127"><span class="linenos">127</span></a><span class="sd">        chemin complet du fichier et son niveau d&#39;accès.</span>
</span><span id="PDFToChroma.trouver_pdfs-128"><a href="#PDFToChroma.trouver_pdfs-128"><span class="linenos">128</span></a>
</span><span id="PDFToChroma.trouver_pdfs-129"><a href="#PDFToChroma.trouver_pdfs-129"><span class="linenos">129</span></a><span class="sd">        :param dossier: Le chemin du dossier dans lequel rechercher les fichiers PDF.</span>
</span><span id="PDFToChroma.trouver_pdfs-130"><a href="#PDFToChroma.trouver_pdfs-130"><span class="linenos">130</span></a><span class="sd">        :type dossier: str, optionnel</span>
</span><span id="PDFToChroma.trouver_pdfs-131"><a href="#PDFToChroma.trouver_pdfs-131"><span class="linenos">131</span></a><span class="sd">        :return: Une liste de tuples contenant pour chaque fichier PDF trouvé son chemin</span>
</span><span id="PDFToChroma.trouver_pdfs-132"><a href="#PDFToChroma.trouver_pdfs-132"><span class="linenos">132</span></a><span class="sd">                 et son niveau d&#39;accès (sous forme de chaîne).</span>
</span><span id="PDFToChroma.trouver_pdfs-133"><a href="#PDFToChroma.trouver_pdfs-133"><span class="linenos">133</span></a><span class="sd">        :rtype: list[tuple[Path, str]]</span>
</span><span id="PDFToChroma.trouver_pdfs-134"><a href="#PDFToChroma.trouver_pdfs-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.trouver_pdfs-135"><a href="#PDFToChroma.trouver_pdfs-135"><span class="linenos">135</span></a>        <span class="n">dossier_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-136"><a href="#PDFToChroma.trouver_pdfs-136"><span class="linenos">136</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PDFToChroma.trouver_pdfs-137"><a href="#PDFToChroma.trouver_pdfs-137"><span class="linenos">137</span></a>
</span><span id="PDFToChroma.trouver_pdfs-138"><a href="#PDFToChroma.trouver_pdfs-138"><span class="linenos">138</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche de PDFs dans </span><span class="si">{</span><span class="n">dossier</span><span class="si">}</span><span class="s2"> et ses sous-dossiers...&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-139"><a href="#PDFToChroma.trouver_pdfs-139"><span class="linenos">139</span></a>
</span><span id="PDFToChroma.trouver_pdfs-140"><a href="#PDFToChroma.trouver_pdfs-140"><span class="linenos">140</span></a>        <span class="c1"># Parcourir récursivement tous les dossiers</span>
</span><span id="PDFToChroma.trouver_pdfs-141"><a href="#PDFToChroma.trouver_pdfs-141"><span class="linenos">141</span></a>        <span class="k">for</span> <span class="n">racine</span><span class="p">,</span> <span class="n">repertoires</span><span class="p">,</span> <span class="n">fichiers</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dossier_path</span><span class="p">):</span>
</span><span id="PDFToChroma.trouver_pdfs-142"><a href="#PDFToChroma.trouver_pdfs-142"><span class="linenos">142</span></a>            <span class="n">racine_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">racine</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-143"><a href="#PDFToChroma.trouver_pdfs-143"><span class="linenos">143</span></a>
</span><span id="PDFToChroma.trouver_pdfs-144"><a href="#PDFToChroma.trouver_pdfs-144"><span class="linenos">144</span></a>            <span class="k">for</span> <span class="n">fichier</span> <span class="ow">in</span> <span class="n">fichiers</span><span class="p">:</span>
</span><span id="PDFToChroma.trouver_pdfs-145"><a href="#PDFToChroma.trouver_pdfs-145"><span class="linenos">145</span></a>                <span class="k">if</span> <span class="n">fichier</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">):</span>
</span><span id="PDFToChroma.trouver_pdfs-146"><a href="#PDFToChroma.trouver_pdfs-146"><span class="linenos">146</span></a>                    <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">racine_path</span> <span class="o">/</span> <span class="n">fichier</span>
</span><span id="PDFToChroma.trouver_pdfs-147"><a href="#PDFToChroma.trouver_pdfs-147"><span class="linenos">147</span></a>                    <span class="n">access_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determiner_niveau_acces_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-148"><a href="#PDFToChroma.trouver_pdfs-148"><span class="linenos">148</span></a>
</span><span id="PDFToChroma.trouver_pdfs-149"><a href="#PDFToChroma.trouver_pdfs-149"><span class="linenos">149</span></a>                    <span class="n">pdfs_avec_acces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">))</span>
</span><span id="PDFToChroma.trouver_pdfs-150"><a href="#PDFToChroma.trouver_pdfs-150"><span class="linenos">150</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trouvé: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-151"><a href="#PDFToChroma.trouver_pdfs-151"><span class="linenos">151</span></a>
</span><span id="PDFToChroma.trouver_pdfs-152"><a href="#PDFToChroma.trouver_pdfs-152"><span class="linenos">152</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total PDFs trouvés: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-153"><a href="#PDFToChroma.trouver_pdfs-153"><span class="linenos">153</span></a>
</span><span id="PDFToChroma.trouver_pdfs-154"><a href="#PDFToChroma.trouver_pdfs-154"><span class="linenos">154</span></a>        <span class="c1"># Statistiques par niveau</span>
</span><span id="PDFToChroma.trouver_pdfs-155"><a href="#PDFToChroma.trouver_pdfs-155"><span class="linenos">155</span></a>        <span class="n">stats_niveaux</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PDFToChroma.trouver_pdfs-156"><a href="#PDFToChroma.trouver_pdfs-156"><span class="linenos">156</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">niveau</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma.trouver_pdfs-157"><a href="#PDFToChroma.trouver_pdfs-157"><span class="linenos">157</span></a>            <span class="n">stats_niveaux</span><span class="p">[</span><span class="n">niveau</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">niveau</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PDFToChroma.trouver_pdfs-158"><a href="#PDFToChroma.trouver_pdfs-158"><span class="linenos">158</span></a>
</span><span id="PDFToChroma.trouver_pdfs-159"><a href="#PDFToChroma.trouver_pdfs-159"><span class="linenos">159</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-160"><a href="#PDFToChroma.trouver_pdfs-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_niveaux</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma.trouver_pdfs-161"><a href="#PDFToChroma.trouver_pdfs-161"><span class="linenos">161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.trouver_pdfs-162"><a href="#PDFToChroma.trouver_pdfs-162"><span class="linenos">162</span></a>
</span><span id="PDFToChroma.trouver_pdfs-163"><a href="#PDFToChroma.trouver_pdfs-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">pdfs_avec_acces</span>
</span></pre></div>


            <div class="docstring"><p>Analyse un dossier donné et recherche récursivement tous les fichiers PDF
dans celui-ci et ses sous-dossiers. La fonction détermine également un
niveau d'accès pour chaque fichier PDF trouvé. Les résultats incluent le
chemin complet du fichier et son niveau d'accès.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dossier</strong>:  Le chemin du dossier dans lequel rechercher les fichiers PDF.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Une liste de tuples contenant pour chaque fichier PDF trouvé son chemin
           et son niveau d'accès (sous forme de chaîne).</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.traiter_pdf_avec_gemini" class="classattr">
                                        <input id="PDFToChroma.traiter_pdf_avec_gemini-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">traiter_pdf_avec_gemini</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pdf_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.traiter_pdf_avec_gemini-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.traiter_pdf_avec_gemini"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.traiter_pdf_avec_gemini-165"><a href="#PDFToChroma.traiter_pdf_avec_gemini-165"><span class="linenos">165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">):</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-166"><a href="#PDFToChroma.traiter_pdf_avec_gemini-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-167"><a href="#PDFToChroma.traiter_pdf_avec_gemini-167"><span class="linenos">167</span></a><span class="sd">        Traite un document PDF en utilisant l&#39;API Gemini pour en générer un résumé en français. Cette</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-168"><a href="#PDFToChroma.traiter_pdf_avec_gemini-168"><span class="linenos">168</span></a><span class="sd">        fonction télécharge un fichier PDF, utilise le modèle Gemini pour générer un texte résumé en</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-169"><a href="#PDFToChroma.traiter_pdf_avec_gemini-169"><span class="linenos">169</span></a><span class="sd">        fonction d&#39;une invite, et supprime ensuite le fichier distant pour optimiser l&#39;espace.</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-170"><a href="#PDFToChroma.traiter_pdf_avec_gemini-170"><span class="linenos">170</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-171"><a href="#PDFToChroma.traiter_pdf_avec_gemini-171"><span class="linenos">171</span></a><span class="sd">        :param pdf_path: Le chemin du fichier PDF à traiter.</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-172"><a href="#PDFToChroma.traiter_pdf_avec_gemini-172"><span class="linenos">172</span></a><span class="sd">        :type pdf_path: str</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-173"><a href="#PDFToChroma.traiter_pdf_avec_gemini-173"><span class="linenos">173</span></a><span class="sd">        :return: Le résumé du document PDF, ou None si une erreur s&#39;est produite ou que la génération</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-174"><a href="#PDFToChroma.traiter_pdf_avec_gemini-174"><span class="linenos">174</span></a><span class="sd">                 ne contient pas de texte.</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-175"><a href="#PDFToChroma.traiter_pdf_avec_gemini-175"><span class="linenos">175</span></a><span class="sd">        :rtype: str, optional</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-176"><a href="#PDFToChroma.traiter_pdf_avec_gemini-176"><span class="linenos">176</span></a><span class="sd">        :raises Exception: Exception générique si une erreur survient lors du processus.</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-177"><a href="#PDFToChroma.traiter_pdf_avec_gemini-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-178"><a href="#PDFToChroma.traiter_pdf_avec_gemini-178"><span class="linenos">178</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traitement: </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-179"><a href="#PDFToChroma.traiter_pdf_avec_gemini-179"><span class="linenos">179</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-180"><a href="#PDFToChroma.traiter_pdf_avec_gemini-180"><span class="linenos">180</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-181"><a href="#PDFToChroma.traiter_pdf_avec_gemini-181"><span class="linenos">181</span></a>            <span class="c1"># Upload du PDF vers Gemini File API</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-182"><a href="#PDFToChroma.traiter_pdf_avec_gemini-182"><span class="linenos">182</span></a>            <span class="n">sample_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-183"><a href="#PDFToChroma.traiter_pdf_avec_gemini-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uploaded: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-184"><a href="#PDFToChroma.traiter_pdf_avec_gemini-184"><span class="linenos">184</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-185"><a href="#PDFToChroma.traiter_pdf_avec_gemini-185"><span class="linenos">185</span></a>            <span class="c1"># Demander résumé</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-186"><a href="#PDFToChroma.traiter_pdf_avec_gemini-186"><span class="linenos">186</span></a>            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Résume ce document PDF, en français, en identifiant le titre, le type de document, le sujet principal et un résumé en 4-5 phrases.&quot;</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-187"><a href="#PDFToChroma.traiter_pdf_avec_gemini-187"><span class="linenos">187</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-188"><a href="#PDFToChroma.traiter_pdf_avec_gemini-188"><span class="linenos">188</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-189"><a href="#PDFToChroma.traiter_pdf_avec_gemini-189"><span class="linenos">189</span></a>                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gemini-2.5-flash&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-190"><a href="#PDFToChroma.traiter_pdf_avec_gemini-190"><span class="linenos">190</span></a>                <span class="n">contents</span><span class="o">=</span><span class="p">[</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">prompt</span><span class="p">]</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-191"><a href="#PDFToChroma.traiter_pdf_avec_gemini-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-192"><a href="#PDFToChroma.traiter_pdf_avec_gemini-192"><span class="linenos">192</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-193"><a href="#PDFToChroma.traiter_pdf_avec_gemini-193"><span class="linenos">193</span></a>            <span class="c1"># Supprimer le fichier uploadé pour économiser l&#39;espace</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-194"><a href="#PDFToChroma.traiter_pdf_avec_gemini-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-195"><a href="#PDFToChroma.traiter_pdf_avec_gemini-195"><span class="linenos">195</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fichier supprimé: </span><span class="si">{</span><span class="n">sample_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-196"><a href="#PDFToChroma.traiter_pdf_avec_gemini-196"><span class="linenos">196</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-197"><a href="#PDFToChroma.traiter_pdf_avec_gemini-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-198"><a href="#PDFToChroma.traiter_pdf_avec_gemini-198"><span class="linenos">198</span></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-199"><a href="#PDFToChroma.traiter_pdf_avec_gemini-199"><span class="linenos">199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-200"><a href="#PDFToChroma.traiter_pdf_avec_gemini-200"><span class="linenos">200</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-201"><a href="#PDFToChroma.traiter_pdf_avec_gemini-201"><span class="linenos">201</span></a>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-202"><a href="#PDFToChroma.traiter_pdf_avec_gemini-202"><span class="linenos">202</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-203"><a href="#PDFToChroma.traiter_pdf_avec_gemini-203"><span class="linenos">203</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Erreur: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_pdf_avec_gemini-204"><a href="#PDFToChroma.traiter_pdf_avec_gemini-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Traite un document PDF en utilisant l'API Gemini pour en générer un résumé en français. Cette
fonction télécharge un fichier PDF, utilise le modèle Gemini pour générer un texte résumé en
fonction d'une invite, et supprime ensuite le fichier distant pour optimiser l'espace.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pdf_path</strong>:  Le chemin du fichier PDF à traiter.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Le résumé du document PDF, ou None si une erreur s'est produite ou que la génération
           ne contient pas de texte.</p>
</blockquote>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Exception</strong>:  Exception générique si une erreur survient lors du processus.</li>
</ul>
</div>


                            </div>
                            <div id="PDFToChroma.creer_json_resume" class="classattr">
                                        <input id="PDFToChroma.creer_json_resume-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">creer_json_resume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pdf_path</span>, </span><span class="param"><span class="n">access_level</span>, </span><span class="param"><span class="n">resume_gemini</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.creer_json_resume-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.creer_json_resume"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.creer_json_resume-206"><a href="#PDFToChroma.creer_json_resume-206"><span class="linenos">206</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">creer_json_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume_gemini</span><span class="p">):</span>
</span><span id="PDFToChroma.creer_json_resume-207"><a href="#PDFToChroma.creer_json_resume-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.creer_json_resume-208"><a href="#PDFToChroma.creer_json_resume-208"><span class="linenos">208</span></a><span class="sd">        Génère un fichier JSON résumant les informations d&#39;un fichier PDF donné, en incluant</span>
</span><span id="PDFToChroma.creer_json_resume-209"><a href="#PDFToChroma.creer_json_resume-209"><span class="linenos">209</span></a><span class="sd">        des métadonnées telles que le chemin d&#39;accès, la taille du fichier, le niveau d&#39;accès</span>
</span><span id="PDFToChroma.creer_json_resume-210"><a href="#PDFToChroma.creer_json_resume-210"><span class="linenos">210</span></a><span class="sd">        et un résumé fourni.</span>
</span><span id="PDFToChroma.creer_json_resume-211"><a href="#PDFToChroma.creer_json_resume-211"><span class="linenos">211</span></a>
</span><span id="PDFToChroma.creer_json_resume-212"><a href="#PDFToChroma.creer_json_resume-212"><span class="linenos">212</span></a><span class="sd">        :param pdf_path: Chemin du fichier PDF source. Doit être de type Path.</span>
</span><span id="PDFToChroma.creer_json_resume-213"><a href="#PDFToChroma.creer_json_resume-213"><span class="linenos">213</span></a><span class="sd">        :type pdf_path: Path</span>
</span><span id="PDFToChroma.creer_json_resume-214"><a href="#PDFToChroma.creer_json_resume-214"><span class="linenos">214</span></a><span class="sd">        :param access_level: Niveau d&#39;accès associé au PDF.</span>
</span><span id="PDFToChroma.creer_json_resume-215"><a href="#PDFToChroma.creer_json_resume-215"><span class="linenos">215</span></a><span class="sd">        :type access_level: str</span>
</span><span id="PDFToChroma.creer_json_resume-216"><a href="#PDFToChroma.creer_json_resume-216"><span class="linenos">216</span></a><span class="sd">        :param resume_gemini: Résumé du document donné sous forme de chaîne de caractères.</span>
</span><span id="PDFToChroma.creer_json_resume-217"><a href="#PDFToChroma.creer_json_resume-217"><span class="linenos">217</span></a><span class="sd">        :type resume_gemini: str</span>
</span><span id="PDFToChroma.creer_json_resume-218"><a href="#PDFToChroma.creer_json_resume-218"><span class="linenos">218</span></a><span class="sd">        :return: Dictionnaire contenant les métadonnées et informations générées pour le JSON.</span>
</span><span id="PDFToChroma.creer_json_resume-219"><a href="#PDFToChroma.creer_json_resume-219"><span class="linenos">219</span></a><span class="sd">        :rtype: dict</span>
</span><span id="PDFToChroma.creer_json_resume-220"><a href="#PDFToChroma.creer_json_resume-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.creer_json_resume-221"><a href="#PDFToChroma.creer_json_resume-221"><span class="linenos">221</span></a>        <span class="c1"># Sauvegarder le JSON</span>
</span><span id="PDFToChroma.creer_json_resume-222"><a href="#PDFToChroma.creer_json_resume-222"><span class="linenos">222</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.creer_json_resume-223"><a href="#PDFToChroma.creer_json_resume-223"><span class="linenos">223</span></a>        <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PDFToChroma.creer_json_resume-224"><a href="#PDFToChroma.creer_json_resume-224"><span class="linenos">224</span></a>
</span><span id="PDFToChroma.creer_json_resume-225"><a href="#PDFToChroma.creer_json_resume-225"><span class="linenos">225</span></a>        <span class="n">json_file</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span id="PDFToChroma.creer_json_resume-226"><a href="#PDFToChroma.creer_json_resume-226"><span class="linenos">226</span></a>
</span><span id="PDFToChroma.creer_json_resume-227"><a href="#PDFToChroma.creer_json_resume-227"><span class="linenos">227</span></a>        <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma.creer_json_resume-228"><a href="#PDFToChroma.creer_json_resume-228"><span class="linenos">228</span></a>            <span class="s2">&quot;resume_gemini&quot;</span><span class="p">:</span> <span class="n">resume_gemini</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-229"><a href="#PDFToChroma.creer_json_resume-229"><span class="linenos">229</span></a>            <span class="s2">&quot;fichier_source&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-230"><a href="#PDFToChroma.creer_json_resume-230"><span class="linenos">230</span></a>            <span class="s2">&quot;type_document&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-231"><a href="#PDFToChroma.creer_json_resume-231"><span class="linenos">231</span></a>            <span class="s2">&quot;taille_fichier&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-232"><a href="#PDFToChroma.creer_json_resume-232"><span class="linenos">232</span></a>            <span class="s2">&quot;titre_contextuel&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="PDFToChroma.creer_json_resume-233"><a href="#PDFToChroma.creer_json_resume-233"><span class="linenos">233</span></a>            <span class="s2">&quot;pdf_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">),</span>
</span><span id="PDFToChroma.creer_json_resume-234"><a href="#PDFToChroma.creer_json_resume-234"><span class="linenos">234</span></a>            <span class="s2">&quot;source_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
</span><span id="PDFToChroma.creer_json_resume-235"><a href="#PDFToChroma.creer_json_resume-235"><span class="linenos">235</span></a>            <span class="s2">&quot;access_level&quot;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-236"><a href="#PDFToChroma.creer_json_resume-236"><span class="linenos">236</span></a>            <span class="s2">&quot;document_type&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-237"><a href="#PDFToChroma.creer_json_resume-237"><span class="linenos">237</span></a>            <span class="s2">&quot;access_indicator&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;PDF </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="PDFToChroma.creer_json_resume-238"><a href="#PDFToChroma.creer_json_resume-238"><span class="linenos">238</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="PDFToChroma.creer_json_resume-239"><a href="#PDFToChroma.creer_json_resume-239"><span class="linenos">239</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma.creer_json_resume-240"><a href="#PDFToChroma.creer_json_resume-240"><span class="linenos">240</span></a>
</span><span id="PDFToChroma.creer_json_resume-241"><a href="#PDFToChroma.creer_json_resume-241"><span class="linenos">241</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PDFToChroma.creer_json_resume-242"><a href="#PDFToChroma.creer_json_resume-242"><span class="linenos">242</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="PDFToChroma.creer_json_resume-243"><a href="#PDFToChroma.creer_json_resume-243"><span class="linenos">243</span></a>
</span><span id="PDFToChroma.creer_json_resume-244"><a href="#PDFToChroma.creer_json_resume-244"><span class="linenos">244</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  JSON sauvé: </span><span class="si">{</span><span class="n">json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.creer_json_resume-245"><a href="#PDFToChroma.creer_json_resume-245"><span class="linenos">245</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Niveau d&#39;accès: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.creer_json_resume-246"><a href="#PDFToChroma.creer_json_resume-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">json_data</span>
</span></pre></div>


            <div class="docstring"><p>Génère un fichier JSON résumant les informations d'un fichier PDF donné, en incluant
des métadonnées telles que le chemin d'accès, la taille du fichier, le niveau d'accès
et un résumé fourni.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pdf_path</strong>:  Chemin du fichier PDF source. Doit être de type Path.</li>
<li><strong>access_level</strong>:  Niveau d'accès associé au PDF.</li>
<li><strong>resume_gemini</strong>:  Résumé du document donné sous forme de chaîne de caractères.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Dictionnaire contenant les métadonnées et informations générées pour le JSON.</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.ajouter_a_chromadb" class="classattr">
                                        <input id="PDFToChroma.ajouter_a_chromadb-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ajouter_a_chromadb</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">json_data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.ajouter_a_chromadb-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.ajouter_a_chromadb"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.ajouter_a_chromadb-248"><a href="#PDFToChroma.ajouter_a_chromadb-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ajouter_a_chromadb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-249"><a href="#PDFToChroma.ajouter_a_chromadb-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-250"><a href="#PDFToChroma.ajouter_a_chromadb-250"><span class="linenos">250</span></a><span class="sd">        Ajoute un document PDF et ses métadonnées à une collection ChromaDB. Cette méthode</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-251"><a href="#PDFToChroma.ajouter_a_chromadb-251"><span class="linenos">251</span></a><span class="sd">        génère une description textuelle basée sur les données du document, crée un embedding</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-252"><a href="#PDFToChroma.ajouter_a_chromadb-252"><span class="linenos">252</span></a><span class="sd">        avec un modèle d&#39;encodage fourni, et enregistre les métadonnées ainsi que le contenu</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-253"><a href="#PDFToChroma.ajouter_a_chromadb-253"><span class="linenos">253</span></a><span class="sd">        associé dans la base de données.</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-254"><a href="#PDFToChroma.ajouter_a_chromadb-254"><span class="linenos">254</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-255"><a href="#PDFToChroma.ajouter_a_chromadb-255"><span class="linenos">255</span></a><span class="sd">        :param json_data: Un dictionnaire contenant les informations concernant le</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-256"><a href="#PDFToChroma.ajouter_a_chromadb-256"><span class="linenos">256</span></a><span class="sd">            fichier PDF à traiter et à ajouter dans la base de données.</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-257"><a href="#PDFToChroma.ajouter_a_chromadb-257"><span class="linenos">257</span></a><span class="sd">        :type json_data: dict</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-258"><a href="#PDFToChroma.ajouter_a_chromadb-258"><span class="linenos">258</span></a><span class="sd">        :return: L&#39;identifiant unique (ID) généré pour le document ajouté dans ChromaDB.</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-259"><a href="#PDFToChroma.ajouter_a_chromadb-259"><span class="linenos">259</span></a><span class="sd">        :rtype: str</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-260"><a href="#PDFToChroma.ajouter_a_chromadb-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-261"><a href="#PDFToChroma.ajouter_a_chromadb-261"><span class="linenos">261</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-262"><a href="#PDFToChroma.ajouter_a_chromadb-262"><span class="linenos">262</span></a>        <span class="c1"># Créer description pour la recherche</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-263"><a href="#PDFToChroma.ajouter_a_chromadb-263"><span class="linenos">263</span></a>        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DOCUMENT PDF: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-264"><a href="#PDFToChroma.ajouter_a_chromadb-264"><span class="linenos">264</span></a><span class="s2">TYPE: Document PDF</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-265"><a href="#PDFToChroma.ajouter_a_chromadb-265"><span class="linenos">265</span></a><span class="s2">NIVEAU D&#39;ACCÈS: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-266"><a href="#PDFToChroma.ajouter_a_chromadb-266"><span class="linenos">266</span></a><span class="s2">DOSSIER: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">]</span><span class="si">}</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-267"><a href="#PDFToChroma.ajouter_a_chromadb-267"><span class="linenos">267</span></a><span class="s2">CONTENU: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;resume_gemini&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-268"><a href="#PDFToChroma.ajouter_a_chromadb-268"><span class="linenos">268</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-269"><a href="#PDFToChroma.ajouter_a_chromadb-269"><span class="linenos">269</span></a>        <span class="c1"># Générer embedding</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-270"><a href="#PDFToChroma.ajouter_a_chromadb-270"><span class="linenos">270</span></a>        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">description</span><span class="p">])</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-271"><a href="#PDFToChroma.ajouter_a_chromadb-271"><span class="linenos">271</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-272"><a href="#PDFToChroma.ajouter_a_chromadb-272"><span class="linenos">272</span></a>        <span class="c1"># Métadonnées pour ChromaDB avec niveau d&#39;accès</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-273"><a href="#PDFToChroma.ajouter_a_chromadb-273"><span class="linenos">273</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-274"><a href="#PDFToChroma.ajouter_a_chromadb-274"><span class="linenos">274</span></a>            <span class="s1">&#39;fichier_source&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-275"><a href="#PDFToChroma.ajouter_a_chromadb-275"><span class="linenos">275</span></a>            <span class="s1">&#39;type_document&#39;</span><span class="p">:</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-276"><a href="#PDFToChroma.ajouter_a_chromadb-276"><span class="linenos">276</span></a>            <span class="s1">&#39;taille_fichier&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;taille_fichier&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-277"><a href="#PDFToChroma.ajouter_a_chromadb-277"><span class="linenos">277</span></a>            <span class="s1">&#39;pdf_path&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;pdf_path&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-278"><a href="#PDFToChroma.ajouter_a_chromadb-278"><span class="linenos">278</span></a>            <span class="s1">&#39;source_directory&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;source_directory&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-279"><a href="#PDFToChroma.ajouter_a_chromadb-279"><span class="linenos">279</span></a>            <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-280"><a href="#PDFToChroma.ajouter_a_chromadb-280"><span class="linenos">280</span></a>            <span class="s1">&#39;document_type&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;document_type&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-281"><a href="#PDFToChroma.ajouter_a_chromadb-281"><span class="linenos">281</span></a>            <span class="s1">&#39;access_indicator&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_indicator&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-282"><a href="#PDFToChroma.ajouter_a_chromadb-282"><span class="linenos">282</span></a>            <span class="s1">&#39;titre_contextuel&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;titre_contextuel&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-283"><a href="#PDFToChroma.ajouter_a_chromadb-283"><span class="linenos">283</span></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-284"><a href="#PDFToChroma.ajouter_a_chromadb-284"><span class="linenos">284</span></a>            <span class="s1">&#39;description_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-285"><a href="#PDFToChroma.ajouter_a_chromadb-285"><span class="linenos">285</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-286"><a href="#PDFToChroma.ajouter_a_chromadb-286"><span class="linenos">286</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-287"><a href="#PDFToChroma.ajouter_a_chromadb-287"><span class="linenos">287</span></a>        <span class="c1"># Ajouter à la collection</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-288"><a href="#PDFToChroma.ajouter_a_chromadb-288"><span class="linenos">288</span></a>        <span class="n">doc_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-289"><a href="#PDFToChroma.ajouter_a_chromadb-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-290"><a href="#PDFToChroma.ajouter_a_chromadb-290"><span class="linenos">290</span></a>            <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-291"><a href="#PDFToChroma.ajouter_a_chromadb-291"><span class="linenos">291</span></a>            <span class="n">embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-292"><a href="#PDFToChroma.ajouter_a_chromadb-292"><span class="linenos">292</span></a>            <span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="n">description</span><span class="p">],</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-293"><a href="#PDFToChroma.ajouter_a_chromadb-293"><span class="linenos">293</span></a>            <span class="n">metadatas</span><span class="o">=</span><span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-294"><a href="#PDFToChroma.ajouter_a_chromadb-294"><span class="linenos">294</span></a>        <span class="p">)</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-295"><a href="#PDFToChroma.ajouter_a_chromadb-295"><span class="linenos">295</span></a>
</span><span id="PDFToChroma.ajouter_a_chromadb-296"><a href="#PDFToChroma.ajouter_a_chromadb-296"><span class="linenos">296</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ajouté à ChromaDB: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> (niveau: </span><span class="si">{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.ajouter_a_chromadb-297"><a href="#PDFToChroma.ajouter_a_chromadb-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="n">doc_id</span>
</span></pre></div>


            <div class="docstring"><p>Ajoute un document PDF et ses métadonnées à une collection ChromaDB. Cette méthode
génère une description textuelle basée sur les données du document, crée un embedding
avec un modèle d'encodage fourni, et enregistre les métadonnées ainsi que le contenu
associé dans la base de données.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>json_data</strong>:  Un dictionnaire contenant les informations concernant le
fichier PDF à traiter et à ajouter dans la base de données.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>L'identifiant unique (ID) généré pour le document ajouté dans ChromaDB.</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.traiter_tous_les_pdfs" class="classattr">
                                        <input id="PDFToChroma.traiter_tous_les_pdfs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">traiter_tous_les_pdfs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dossier</span><span class="o">=</span><span class="s1">&#39;data&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.traiter_tous_les_pdfs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.traiter_tous_les_pdfs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.traiter_tous_les_pdfs-299"><a href="#PDFToChroma.traiter_tous_les_pdfs-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">traiter_tous_les_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dossier</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-300"><a href="#PDFToChroma.traiter_tous_les_pdfs-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-301"><a href="#PDFToChroma.traiter_tous_les_pdfs-301"><span class="linenos">301</span></a><span class="sd">        Traite tous les fichiers PDF dans un dossier donné, génère des résumés,</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-302"><a href="#PDFToChroma.traiter_tous_les_pdfs-302"><span class="linenos">302</span></a><span class="sd">        et les stocke dans une base de données avec un niveau d&#39;accès spécifié.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-303"><a href="#PDFToChroma.traiter_tous_les_pdfs-303"><span class="linenos">303</span></a><span class="sd">        Cette méthode utilise un flux de traitement qui comprend la recherche des PDF,</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-304"><a href="#PDFToChroma.traiter_tous_les_pdfs-304"><span class="linenos">304</span></a><span class="sd">        leur analyse via un outil de résumé, la création de métadonnées adéquates et</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-305"><a href="#PDFToChroma.traiter_tous_les_pdfs-305"><span class="linenos">305</span></a><span class="sd">        l&#39;ajout à une base de données.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-306"><a href="#PDFToChroma.traiter_tous_les_pdfs-306"><span class="linenos">306</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-307"><a href="#PDFToChroma.traiter_tous_les_pdfs-307"><span class="linenos">307</span></a><span class="sd">        Le traitement effectue les étapes suivantes :</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-308"><a href="#PDFToChroma.traiter_tous_les_pdfs-308"><span class="linenos">308</span></a><span class="sd">        - Recherche des PDF dans un dossier, avec identification de leur niveau d&#39;accès.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-309"><a href="#PDFToChroma.traiter_tous_les_pdfs-309"><span class="linenos">309</span></a><span class="sd">        - Création de résumés pour chaque fichier PDF.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-310"><a href="#PDFToChroma.traiter_tous_les_pdfs-310"><span class="linenos">310</span></a><span class="sd">        - Création de documents JSON contenant les résumés et leurs métadonnées associées.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-311"><a href="#PDFToChroma.traiter_tous_les_pdfs-311"><span class="linenos">311</span></a><span class="sd">        - Insertion des documents JSON dans une collection d&#39;une base de données.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-312"><a href="#PDFToChroma.traiter_tous_les_pdfs-312"><span class="linenos">312</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-313"><a href="#PDFToChroma.traiter_tous_les_pdfs-313"><span class="linenos">313</span></a><span class="sd">        Cette méthode fournit un résumé détaillé sur les statistiques des fichiers PDF analysés</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-314"><a href="#PDFToChroma.traiter_tous_les_pdfs-314"><span class="linenos">314</span></a><span class="sd">        et donne un aperçu final des données ajoutées dans la base.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-315"><a href="#PDFToChroma.traiter_tous_les_pdfs-315"><span class="linenos">315</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-316"><a href="#PDFToChroma.traiter_tous_les_pdfs-316"><span class="linenos">316</span></a><span class="sd">        :param dossier: Chemin du dossier contenant les fichiers PDF à traiter. Par défaut, &quot;data&quot;.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-317"><a href="#PDFToChroma.traiter_tous_les_pdfs-317"><span class="linenos">317</span></a><span class="sd">        :type dossier: str</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-318"><a href="#PDFToChroma.traiter_tous_les_pdfs-318"><span class="linenos">318</span></a><span class="sd">        :return: Aucune valeur n&#39;est retournée. Les opérations de traitement sont réalisées en place.</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-319"><a href="#PDFToChroma.traiter_tous_les_pdfs-319"><span class="linenos">319</span></a><span class="sd">        :rtype: None</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-320"><a href="#PDFToChroma.traiter_tous_les_pdfs-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-321"><a href="#PDFToChroma.traiter_tous_les_pdfs-321"><span class="linenos">321</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-322"><a href="#PDFToChroma.traiter_tous_les_pdfs-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== DÉBUT DU TRAITEMENT ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-323"><a href="#PDFToChroma.traiter_tous_les_pdfs-323"><span class="linenos">323</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-324"><a href="#PDFToChroma.traiter_tous_les_pdfs-324"><span class="linenos">324</span></a>        <span class="c1"># 1. Trouver les PDFs avec leurs niveaux d&#39;accès</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-325"><a href="#PDFToChroma.traiter_tous_les_pdfs-325"><span class="linenos">325</span></a>        <span class="n">pdfs_avec_acces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trouver_pdfs</span><span class="p">(</span><span class="n">dossier</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-326"><a href="#PDFToChroma.traiter_tous_les_pdfs-326"><span class="linenos">326</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-327"><a href="#PDFToChroma.traiter_tous_les_pdfs-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-328"><a href="#PDFToChroma.traiter_tous_les_pdfs-328"><span class="linenos">328</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun PDF trouvé&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-329"><a href="#PDFToChroma.traiter_tous_les_pdfs-329"><span class="linenos">329</span></a>            <span class="k">return</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-330"><a href="#PDFToChroma.traiter_tous_les_pdfs-330"><span class="linenos">330</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-331"><a href="#PDFToChroma.traiter_tous_les_pdfs-331"><span class="linenos">331</span></a>        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-332"><a href="#PDFToChroma.traiter_tous_les_pdfs-332"><span class="linenos">332</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-333"><a href="#PDFToChroma.traiter_tous_les_pdfs-333"><span class="linenos">333</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-334"><a href="#PDFToChroma.traiter_tous_les_pdfs-334"><span class="linenos">334</span></a>        <span class="c1"># 2. Traiter chaque PDF</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-335"><a href="#PDFToChroma.traiter_tous_les_pdfs-335"><span class="linenos">335</span></a>        <span class="k">for</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">pdfs_avec_acces</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-336"><a href="#PDFToChroma.traiter_tous_les_pdfs-336"><span class="linenos">336</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (Niveau: </span><span class="si">{</span><span class="n">access_level</span><span class="si">}</span><span class="s2">) ---&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-337"><a href="#PDFToChroma.traiter_tous_les_pdfs-337"><span class="linenos">337</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-338"><a href="#PDFToChroma.traiter_tous_les_pdfs-338"><span class="linenos">338</span></a>            <span class="c1"># Résumé avec Gemini</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-339"><a href="#PDFToChroma.traiter_tous_les_pdfs-339"><span class="linenos">339</span></a>            <span class="n">resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traiter_pdf_avec_gemini</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-340"><a href="#PDFToChroma.traiter_tous_les_pdfs-340"><span class="linenos">340</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-341"><a href="#PDFToChroma.traiter_tous_les_pdfs-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">resume</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-342"><a href="#PDFToChroma.traiter_tous_les_pdfs-342"><span class="linenos">342</span></a>                <span class="c1"># Créer JSON avec niveau d&#39;accès</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-343"><a href="#PDFToChroma.traiter_tous_les_pdfs-343"><span class="linenos">343</span></a>                <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_json_resume</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">access_level</span><span class="p">,</span> <span class="n">resume</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-344"><a href="#PDFToChroma.traiter_tous_les_pdfs-344"><span class="linenos">344</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-345"><a href="#PDFToChroma.traiter_tous_les_pdfs-345"><span class="linenos">345</span></a>                <span class="c1"># Ajouter à ChromaDB</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-346"><a href="#PDFToChroma.traiter_tous_les_pdfs-346"><span class="linenos">346</span></a>                <span class="n">doc_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ajouter_a_chromadb</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-347"><a href="#PDFToChroma.traiter_tous_les_pdfs-347"><span class="linenos">347</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-348"><a href="#PDFToChroma.traiter_tous_les_pdfs-348"><span class="linenos">348</span></a>                <span class="k">if</span> <span class="n">doc_id</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-349"><a href="#PDFToChroma.traiter_tous_les_pdfs-349"><span class="linenos">349</span></a>                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-350"><a href="#PDFToChroma.traiter_tous_les_pdfs-350"><span class="linenos">350</span></a>                    <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-351"><a href="#PDFToChroma.traiter_tous_les_pdfs-351"><span class="linenos">351</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Succès&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-352"><a href="#PDFToChroma.traiter_tous_les_pdfs-352"><span class="linenos">352</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-353"><a href="#PDFToChroma.traiter_tous_les_pdfs-353"><span class="linenos">353</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Échec&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-354"><a href="#PDFToChroma.traiter_tous_les_pdfs-354"><span class="linenos">354</span></a>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-355"><a href="#PDFToChroma.traiter_tous_les_pdfs-355"><span class="linenos">355</span></a>        <span class="c1"># 3. Résultats finaux</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-356"><a href="#PDFToChroma.traiter_tous_les_pdfs-356"><span class="linenos">356</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== RÉSULTATS ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-357"><a href="#PDFToChroma.traiter_tous_les_pdfs-357"><span class="linenos">357</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PDFs traités avec succès: </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdfs_avec_acces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-358"><a href="#PDFToChroma.traiter_tous_les_pdfs-358"><span class="linenos">358</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition par niveau d&#39;accès traités:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-359"><a href="#PDFToChroma.traiter_tous_les_pdfs-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-360"><a href="#PDFToChroma.traiter_tous_les_pdfs-360"><span class="linenos">360</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> PDF(s)&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.traiter_tous_les_pdfs-361"><a href="#PDFToChroma.traiter_tous_les_pdfs-361"><span class="linenos">361</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection ChromaDB: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> documents total&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Traite tous les fichiers PDF dans un dossier donné, génère des résumés,
et les stocke dans une base de données avec un niveau d'accès spécifié.
Cette méthode utilise un flux de traitement qui comprend la recherche des PDF,
leur analyse via un outil de résumé, la création de métadonnées adéquates et
l'ajout à une base de données.</p>

<p>Le traitement effectue les étapes suivantes :</p>

<ul>
<li>Recherche des PDF dans un dossier, avec identification de leur niveau d'accès.</li>
<li>Création de résumés pour chaque fichier PDF.</li>
<li>Création de documents JSON contenant les résumés et leurs métadonnées associées.</li>
<li>Insertion des documents JSON dans une collection d'une base de données.</li>
</ul>

<p>Cette méthode fournit un résumé détaillé sur les statistiques des fichiers PDF analysés
et donne un aperçu final des données ajoutées dans la base.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dossier</strong>:  Chemin du dossier contenant les fichiers PDF à traiter. Par défaut, "data".</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Aucune valeur n'est retournée. Les opérations de traitement sont réalisées en place.</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.rechercher_pdfs" class="classattr">
                                        <input id="PDFToChroma.rechercher_pdfs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rechercher_pdfs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span>, </span><span class="param"><span class="n">user_role</span><span class="o">=</span><span class="s1">&#39;public&#39;</span>, </span><span class="param"><span class="n">n_results</span><span class="o">=</span><span class="mi">5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.rechercher_pdfs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.rechercher_pdfs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.rechercher_pdfs-363"><a href="#PDFToChroma.rechercher_pdfs-363"><span class="linenos">363</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rechercher_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="PDFToChroma.rechercher_pdfs-364"><a href="#PDFToChroma.rechercher_pdfs-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.rechercher_pdfs-365"><a href="#PDFToChroma.rechercher_pdfs-365"><span class="linenos">365</span></a><span class="sd">        Rechercher des fichiers PDF dans une collection en fonction d&#39;une requête donnée,</span>
</span><span id="PDFToChroma.rechercher_pdfs-366"><a href="#PDFToChroma.rechercher_pdfs-366"><span class="linenos">366</span></a><span class="sd">        du rôle utilisateur et du nombre de résultats souhaités. Les résultats retournés</span>
</span><span id="PDFToChroma.rechercher_pdfs-367"><a href="#PDFToChroma.rechercher_pdfs-367"><span class="linenos">367</span></a><span class="sd">        sont filtrés en fonction du niveau d&#39;accès autorisé pour le rôle spécifié.</span>
</span><span id="PDFToChroma.rechercher_pdfs-368"><a href="#PDFToChroma.rechercher_pdfs-368"><span class="linenos">368</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-369"><a href="#PDFToChroma.rechercher_pdfs-369"><span class="linenos">369</span></a><span class="sd">        :param query: La requête de recherche sous forme de texte.</span>
</span><span id="PDFToChroma.rechercher_pdfs-370"><a href="#PDFToChroma.rechercher_pdfs-370"><span class="linenos">370</span></a><span class="sd">        :type query: str</span>
</span><span id="PDFToChroma.rechercher_pdfs-371"><a href="#PDFToChroma.rechercher_pdfs-371"><span class="linenos">371</span></a><span class="sd">        :param user_role: Le rôle de l&#39;utilisateur effectuant la recherche (public, internal,</span>
</span><span id="PDFToChroma.rechercher_pdfs-372"><a href="#PDFToChroma.rechercher_pdfs-372"><span class="linenos">372</span></a><span class="sd">            admin). Par défaut, il est défini sur &quot;public&quot;.</span>
</span><span id="PDFToChroma.rechercher_pdfs-373"><a href="#PDFToChroma.rechercher_pdfs-373"><span class="linenos">373</span></a><span class="sd">        :type user_role: str</span>
</span><span id="PDFToChroma.rechercher_pdfs-374"><a href="#PDFToChroma.rechercher_pdfs-374"><span class="linenos">374</span></a><span class="sd">        :param n_results: Le nombre de résultats à retourner après filtrage basé sur le</span>
</span><span id="PDFToChroma.rechercher_pdfs-375"><a href="#PDFToChroma.rechercher_pdfs-375"><span class="linenos">375</span></a><span class="sd">            rôle utilisateur. Par défaut, 5 résultats sont retournés.</span>
</span><span id="PDFToChroma.rechercher_pdfs-376"><a href="#PDFToChroma.rechercher_pdfs-376"><span class="linenos">376</span></a><span class="sd">        :type n_results: int</span>
</span><span id="PDFToChroma.rechercher_pdfs-377"><a href="#PDFToChroma.rechercher_pdfs-377"><span class="linenos">377</span></a><span class="sd">        :return: Une liste des résultats filtrés contenant des informations sur les fichiers</span>
</span><span id="PDFToChroma.rechercher_pdfs-378"><a href="#PDFToChroma.rechercher_pdfs-378"><span class="linenos">378</span></a><span class="sd">            trouvés, telles que le nom du fichier, le type du document, le niveau</span>
</span><span id="PDFToChroma.rechercher_pdfs-379"><a href="#PDFToChroma.rechercher_pdfs-379"><span class="linenos">379</span></a><span class="sd">            d&#39;accès, la pertinence et le dossier source. Si aucun résultat n&#39;est trouvé,</span>
</span><span id="PDFToChroma.rechercher_pdfs-380"><a href="#PDFToChroma.rechercher_pdfs-380"><span class="linenos">380</span></a><span class="sd">            retourne une liste vide.</span>
</span><span id="PDFToChroma.rechercher_pdfs-381"><a href="#PDFToChroma.rechercher_pdfs-381"><span class="linenos">381</span></a><span class="sd">        :rtype: list[dict]</span>
</span><span id="PDFToChroma.rechercher_pdfs-382"><a href="#PDFToChroma.rechercher_pdfs-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.rechercher_pdfs-383"><a href="#PDFToChroma.rechercher_pdfs-383"><span class="linenos">383</span></a>        <span class="c1"># Mapping des rôles utilisateur vers les niveaux d&#39;accès autorisés</span>
</span><span id="PDFToChroma.rechercher_pdfs-384"><a href="#PDFToChroma.rechercher_pdfs-384"><span class="linenos">384</span></a>        <span class="n">roles_access</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PDFToChroma.rechercher_pdfs-385"><a href="#PDFToChroma.rechercher_pdfs-385"><span class="linenos">385</span></a>            <span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.rechercher_pdfs-386"><a href="#PDFToChroma.rechercher_pdfs-386"><span class="linenos">386</span></a>            <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">],</span>
</span><span id="PDFToChroma.rechercher_pdfs-387"><a href="#PDFToChroma.rechercher_pdfs-387"><span class="linenos">387</span></a>            <span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">]</span>
</span><span id="PDFToChroma.rechercher_pdfs-388"><a href="#PDFToChroma.rechercher_pdfs-388"><span class="linenos">388</span></a>        <span class="p">}</span>
</span><span id="PDFToChroma.rechercher_pdfs-389"><a href="#PDFToChroma.rechercher_pdfs-389"><span class="linenos">389</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-390"><a href="#PDFToChroma.rechercher_pdfs-390"><span class="linenos">390</span></a>        <span class="n">niveaux_autorises</span> <span class="o">=</span> <span class="n">roles_access</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">])</span>
</span><span id="PDFToChroma.rechercher_pdfs-391"><a href="#PDFToChroma.rechercher_pdfs-391"><span class="linenos">391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recherche pour rôle &#39;</span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">&#39; - Niveaux autorisés: </span><span class="si">{</span><span class="n">niveaux_autorises</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-392"><a href="#PDFToChroma.rechercher_pdfs-392"><span class="linenos">392</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-393"><a href="#PDFToChroma.rechercher_pdfs-393"><span class="linenos">393</span></a>        <span class="c1"># Générer embedding de la requête</span>
</span><span id="PDFToChroma.rechercher_pdfs-394"><a href="#PDFToChroma.rechercher_pdfs-394"><span class="linenos">394</span></a>        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">query</span><span class="p">])</span>
</span><span id="PDFToChroma.rechercher_pdfs-395"><a href="#PDFToChroma.rechercher_pdfs-395"><span class="linenos">395</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-396"><a href="#PDFToChroma.rechercher_pdfs-396"><span class="linenos">396</span></a>        <span class="c1"># Rechercher (plus de résultats pour permettre le filtrage)</span>
</span><span id="PDFToChroma.rechercher_pdfs-397"><a href="#PDFToChroma.rechercher_pdfs-397"><span class="linenos">397</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="PDFToChroma.rechercher_pdfs-398"><a href="#PDFToChroma.rechercher_pdfs-398"><span class="linenos">398</span></a>            <span class="n">query_embeddings</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
</span><span id="PDFToChroma.rechercher_pdfs-399"><a href="#PDFToChroma.rechercher_pdfs-399"><span class="linenos">399</span></a>            <span class="n">n_results</span><span class="o">=</span><span class="n">n_results</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Plus de résultats pour filtrage</span>
</span><span id="PDFToChroma.rechercher_pdfs-400"><a href="#PDFToChroma.rechercher_pdfs-400"><span class="linenos">400</span></a>            <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="s1">&#39;metadatas&#39;</span><span class="p">,</span> <span class="s1">&#39;distances&#39;</span><span class="p">]</span>
</span><span id="PDFToChroma.rechercher_pdfs-401"><a href="#PDFToChroma.rechercher_pdfs-401"><span class="linenos">401</span></a>        <span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-402"><a href="#PDFToChroma.rechercher_pdfs-402"><span class="linenos">402</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-403"><a href="#PDFToChroma.rechercher_pdfs-403"><span class="linenos">403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Résultats pour &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; (rôle: </span><span class="si">{</span><span class="n">user_role</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-404"><a href="#PDFToChroma.rechercher_pdfs-404"><span class="linenos">404</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-405"><a href="#PDFToChroma.rechercher_pdfs-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="PDFToChroma.rechercher_pdfs-406"><a href="#PDFToChroma.rechercher_pdfs-406"><span class="linenos">406</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun résultat trouvé&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-407"><a href="#PDFToChroma.rechercher_pdfs-407"><span class="linenos">407</span></a>            <span class="k">return</span>
</span><span id="PDFToChroma.rechercher_pdfs-408"><a href="#PDFToChroma.rechercher_pdfs-408"><span class="linenos">408</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-409"><a href="#PDFToChroma.rechercher_pdfs-409"><span class="linenos">409</span></a>        <span class="n">resultats_filtres</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PDFToChroma.rechercher_pdfs-410"><a href="#PDFToChroma.rechercher_pdfs-410"><span class="linenos">410</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-411"><a href="#PDFToChroma.rechercher_pdfs-411"><span class="linenos">411</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
</span><span id="PDFToChroma.rechercher_pdfs-412"><a href="#PDFToChroma.rechercher_pdfs-412"><span class="linenos">412</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="PDFToChroma.rechercher_pdfs-413"><a href="#PDFToChroma.rechercher_pdfs-413"><span class="linenos">413</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-414"><a href="#PDFToChroma.rechercher_pdfs-414"><span class="linenos">414</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-415"><a href="#PDFToChroma.rechercher_pdfs-415"><span class="linenos">415</span></a>            <span class="c1"># Filtrer selon le rôle utilisateur</span>
</span><span id="PDFToChroma.rechercher_pdfs-416"><a href="#PDFToChroma.rechercher_pdfs-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">niveaux_autorises</span><span class="p">:</span>
</span><span id="PDFToChroma.rechercher_pdfs-417"><a href="#PDFToChroma.rechercher_pdfs-417"><span class="linenos">417</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="PDFToChroma.rechercher_pdfs-418"><a href="#PDFToChroma.rechercher_pdfs-418"><span class="linenos">418</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-419"><a href="#PDFToChroma.rechercher_pdfs-419"><span class="linenos">419</span></a>                <span class="n">resultats_filtres</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PDFToChroma.rechercher_pdfs-420"><a href="#PDFToChroma.rechercher_pdfs-420"><span class="linenos">420</span></a>                    <span class="s1">&#39;fichier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fichier_source&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
</span><span id="PDFToChroma.rechercher_pdfs-421"><a href="#PDFToChroma.rechercher_pdfs-421"><span class="linenos">421</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">),</span>
</span><span id="PDFToChroma.rechercher_pdfs-422"><a href="#PDFToChroma.rechercher_pdfs-422"><span class="linenos">422</span></a>                    <span class="s1">&#39;access_level&#39;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
</span><span id="PDFToChroma.rechercher_pdfs-423"><a href="#PDFToChroma.rechercher_pdfs-423"><span class="linenos">423</span></a>                    <span class="s1">&#39;pertinence&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance</span><span class="p">,</span>
</span><span id="PDFToChroma.rechercher_pdfs-424"><a href="#PDFToChroma.rechercher_pdfs-424"><span class="linenos">424</span></a>                    <span class="s1">&#39;dossier&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-425"><a href="#PDFToChroma.rechercher_pdfs-425"><span class="linenos">425</span></a>                <span class="p">})</span>
</span><span id="PDFToChroma.rechercher_pdfs-426"><a href="#PDFToChroma.rechercher_pdfs-426"><span class="linenos">426</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-427"><a href="#PDFToChroma.rechercher_pdfs-427"><span class="linenos">427</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n_results</span><span class="p">:</span>
</span><span id="PDFToChroma.rechercher_pdfs-428"><a href="#PDFToChroma.rechercher_pdfs-428"><span class="linenos">428</span></a>                    <span class="k">break</span>
</span><span id="PDFToChroma.rechercher_pdfs-429"><a href="#PDFToChroma.rechercher_pdfs-429"><span class="linenos">429</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-430"><a href="#PDFToChroma.rechercher_pdfs-430"><span class="linenos">430</span></a>        <span class="c1"># Afficher les résultats filtrés</span>
</span><span id="PDFToChroma.rechercher_pdfs-431"><a href="#PDFToChroma.rechercher_pdfs-431"><span class="linenos">431</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">resultat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultats_filtres</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="PDFToChroma.rechercher_pdfs-432"><a href="#PDFToChroma.rechercher_pdfs-432"><span class="linenos">432</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;fichier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-433"><a href="#PDFToChroma.rechercher_pdfs-433"><span class="linenos">433</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Type: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> | Niveau: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;access_level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-434"><a href="#PDFToChroma.rechercher_pdfs-434"><span class="linenos">434</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Dossier: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;dossier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-435"><a href="#PDFToChroma.rechercher_pdfs-435"><span class="linenos">435</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Pertinence: </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;pertinence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.rechercher_pdfs-436"><a href="#PDFToChroma.rechercher_pdfs-436"><span class="linenos">436</span></a>            <span class="nb">print</span><span class="p">()</span>
</span><span id="PDFToChroma.rechercher_pdfs-437"><a href="#PDFToChroma.rechercher_pdfs-437"><span class="linenos">437</span></a>
</span><span id="PDFToChroma.rechercher_pdfs-438"><a href="#PDFToChroma.rechercher_pdfs-438"><span class="linenos">438</span></a>        <span class="k">return</span> <span class="n">resultats_filtres</span>
</span></pre></div>


            <div class="docstring"><p>Rechercher des fichiers PDF dans une collection en fonction d'une requête donnée,
du rôle utilisateur et du nombre de résultats souhaités. Les résultats retournés
sont filtrés en fonction du niveau d'accès autorisé pour le rôle spécifié.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong>:  La requête de recherche sous forme de texte.</li>
<li><strong>user_role</strong>:  Le rôle de l'utilisateur effectuant la recherche (public, internal,
admin). Par défaut, il est défini sur "public".</li>
<li><strong>n_results</strong>:  Le nombre de résultats à retourner après filtrage basé sur le
rôle utilisateur. Par défaut, 5 résultats sont retournés.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Une liste des résultats filtrés contenant des informations sur les fichiers
      trouvés, telles que le nom du fichier, le type du document, le niveau
      d'accès, la pertinence et le dossier source. Si aucun résultat n'est trouvé,
      retourne une liste vide.</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.stats_collection" class="classattr">
                                        <input id="PDFToChroma.stats_collection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stats_collection</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.stats_collection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.stats_collection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.stats_collection-440"><a href="#PDFToChroma.stats_collection-440"><span class="linenos">440</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma.stats_collection-441"><a href="#PDFToChroma.stats_collection-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.stats_collection-442"><a href="#PDFToChroma.stats_collection-442"><span class="linenos">442</span></a><span class="sd">        Calcule et affiche des statistiques sur une collection de documents.</span>
</span><span id="PDFToChroma.stats_collection-443"><a href="#PDFToChroma.stats_collection-443"><span class="linenos">443</span></a>
</span><span id="PDFToChroma.stats_collection-444"><a href="#PDFToChroma.stats_collection-444"><span class="linenos">444</span></a><span class="sd">        Cette méthode permet de collecter des statistiques sur la répartition des types</span>
</span><span id="PDFToChroma.stats_collection-445"><a href="#PDFToChroma.stats_collection-445"><span class="linenos">445</span></a><span class="sd">        de documents et les niveaux d&#39;accès associés dans une collection donnée.</span>
</span><span id="PDFToChroma.stats_collection-446"><a href="#PDFToChroma.stats_collection-446"><span class="linenos">446</span></a><span class="sd">        Les informations sont extraites des métadonnées des documents.</span>
</span><span id="PDFToChroma.stats_collection-447"><a href="#PDFToChroma.stats_collection-447"><span class="linenos">447</span></a>
</span><span id="PDFToChroma.stats_collection-448"><a href="#PDFToChroma.stats_collection-448"><span class="linenos">448</span></a><span class="sd">        :return: Rien. Cette méthode imprime directement les statistiques dans la console.</span>
</span><span id="PDFToChroma.stats_collection-449"><a href="#PDFToChroma.stats_collection-449"><span class="linenos">449</span></a><span class="sd">        :rtype: None</span>
</span><span id="PDFToChroma.stats_collection-450"><a href="#PDFToChroma.stats_collection-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.stats_collection-451"><a href="#PDFToChroma.stats_collection-451"><span class="linenos">451</span></a>
</span><span id="PDFToChroma.stats_collection-452"><a href="#PDFToChroma.stats_collection-452"><span class="linenos">452</span></a>        <span class="c1"># Récupérer tous les documents</span>
</span><span id="PDFToChroma.stats_collection-453"><a href="#PDFToChroma.stats_collection-453"><span class="linenos">453</span></a>        <span class="n">all_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">])</span>
</span><span id="PDFToChroma.stats_collection-454"><a href="#PDFToChroma.stats_collection-454"><span class="linenos">454</span></a>
</span><span id="PDFToChroma.stats_collection-455"><a href="#PDFToChroma.stats_collection-455"><span class="linenos">455</span></a>        <span class="c1"># Compteurs</span>
</span><span id="PDFToChroma.stats_collection-456"><a href="#PDFToChroma.stats_collection-456"><span class="linenos">456</span></a>        <span class="n">stats_par_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tableau&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma.stats_collection-457"><a href="#PDFToChroma.stats_collection-457"><span class="linenos">457</span></a>        <span class="n">stats_par_niveau</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;non_defini&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="PDFToChroma.stats_collection-458"><a href="#PDFToChroma.stats_collection-458"><span class="linenos">458</span></a>
</span><span id="PDFToChroma.stats_collection-459"><a href="#PDFToChroma.stats_collection-459"><span class="linenos">459</span></a>        <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma.stats_collection-460"><a href="#PDFToChroma.stats_collection-460"><span class="linenos">460</span></a>            <span class="c1"># Type de document</span>
</span><span id="PDFToChroma.stats_collection-461"><a href="#PDFToChroma.stats_collection-461"><span class="linenos">461</span></a>            <span class="n">doc_type</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_document&#39;</span><span class="p">,</span> <span class="s1">&#39;tableau&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-462"><a href="#PDFToChroma.stats_collection-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">doc_type</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="PDFToChroma.stats_collection-463"><a href="#PDFToChroma.stats_collection-463"><span class="linenos">463</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.stats_collection-464"><a href="#PDFToChroma.stats_collection-464"><span class="linenos">464</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma.stats_collection-465"><a href="#PDFToChroma.stats_collection-465"><span class="linenos">465</span></a>                <span class="n">stats_par_type</span><span class="p">[</span><span class="s1">&#39;tableau&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.stats_collection-466"><a href="#PDFToChroma.stats_collection-466"><span class="linenos">466</span></a>
</span><span id="PDFToChroma.stats_collection-467"><a href="#PDFToChroma.stats_collection-467"><span class="linenos">467</span></a>            <span class="c1"># Niveau d&#39;accès</span>
</span><span id="PDFToChroma.stats_collection-468"><a href="#PDFToChroma.stats_collection-468"><span class="linenos">468</span></a>            <span class="n">access_level</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_level&#39;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-469"><a href="#PDFToChroma.stats_collection-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="n">access_level</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="p">:</span>
</span><span id="PDFToChroma.stats_collection-470"><a href="#PDFToChroma.stats_collection-470"><span class="linenos">470</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="n">access_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.stats_collection-471"><a href="#PDFToChroma.stats_collection-471"><span class="linenos">471</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PDFToChroma.stats_collection-472"><a href="#PDFToChroma.stats_collection-472"><span class="linenos">472</span></a>                <span class="n">stats_par_niveau</span><span class="p">[</span><span class="s1">&#39;non_defini&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PDFToChroma.stats_collection-473"><a href="#PDFToChroma.stats_collection-473"><span class="linenos">473</span></a>
</span><span id="PDFToChroma.stats_collection-474"><a href="#PDFToChroma.stats_collection-474"><span class="linenos">474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== STATISTIQUES COLLECTION ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-475"><a href="#PDFToChroma.stats_collection-475"><span class="linenos">475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total documents: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-476"><a href="#PDFToChroma.stats_collection-476"><span class="linenos">476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par type:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-477"><a href="#PDFToChroma.stats_collection-477"><span class="linenos">477</span></a>        <span class="k">for</span> <span class="n">type_doc</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma.stats_collection-478"><a href="#PDFToChroma.stats_collection-478"><span class="linenos">478</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">type_doc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-479"><a href="#PDFToChroma.stats_collection-479"><span class="linenos">479</span></a>
</span><span id="PDFToChroma.stats_collection-480"><a href="#PDFToChroma.stats_collection-480"><span class="linenos">480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Répartition par niveau d&#39;accès:&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.stats_collection-481"><a href="#PDFToChroma.stats_collection-481"><span class="linenos">481</span></a>        <span class="k">for</span> <span class="n">niveau</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats_par_niveau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PDFToChroma.stats_collection-482"><a href="#PDFToChroma.stats_collection-482"><span class="linenos">482</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">niveau</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calcule et affiche des statistiques sur une collection de documents.</p>

<p>Cette méthode permet de collecter des statistiques sur la répartition des types
de documents et les niveaux d'accès associés dans une collection donnée.
Les informations sont extraites des métadonnées des documents.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Rien. Cette méthode imprime directement les statistiques dans la console.</p>
</blockquote>
</div>


                            </div>
                            <div id="PDFToChroma.tester_acces_par_role" class="classattr">
                                        <input id="PDFToChroma.tester_acces_par_role-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tester_acces_par_role</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PDFToChroma.tester_acces_par_role-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PDFToChroma.tester_acces_par_role"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PDFToChroma.tester_acces_par_role-484"><a href="#PDFToChroma.tester_acces_par_role-484"><span class="linenos">484</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tester_acces_par_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PDFToChroma.tester_acces_par_role-485"><a href="#PDFToChroma.tester_acces_par_role-485"><span class="linenos">485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PDFToChroma.tester_acces_par_role-486"><a href="#PDFToChroma.tester_acces_par_role-486"><span class="linenos">486</span></a><span class="sd">        Effectue un test des niveaux d&#39;accès à une fonctionnalité de recherche de PDF selon</span>
</span><span id="PDFToChroma.tester_acces_par_role-487"><a href="#PDFToChroma.tester_acces_par_role-487"><span class="linenos">487</span></a><span class="sd">        des rôles spécifiques.</span>
</span><span id="PDFToChroma.tester_acces_par_role-488"><a href="#PDFToChroma.tester_acces_par_role-488"><span class="linenos">488</span></a>
</span><span id="PDFToChroma.tester_acces_par_role-489"><a href="#PDFToChroma.tester_acces_par_role-489"><span class="linenos">489</span></a><span class="sd">        Le test est effectué pour les rôles suivants : &#39;public&#39;, &#39;internal&#39; et &#39;admin&#39;.</span>
</span><span id="PDFToChroma.tester_acces_par_role-490"><a href="#PDFToChroma.tester_acces_par_role-490"><span class="linenos">490</span></a><span class="sd">        Pour chacun de ces rôles, une recherche est réalisée avec un mot-clé donné, et les</span>
</span><span id="PDFToChroma.tester_acces_par_role-491"><a href="#PDFToChroma.tester_acces_par_role-491"><span class="linenos">491</span></a><span class="sd">        résultats sont imprimés pour inspection. Cette méthode sert à évaluer si les restrictions</span>
</span><span id="PDFToChroma.tester_acces_par_role-492"><a href="#PDFToChroma.tester_acces_par_role-492"><span class="linenos">492</span></a><span class="sd">        d&#39;accès basées sur les rôles fonctionnent correctement.</span>
</span><span id="PDFToChroma.tester_acces_par_role-493"><a href="#PDFToChroma.tester_acces_par_role-493"><span class="linenos">493</span></a>
</span><span id="PDFToChroma.tester_acces_par_role-494"><a href="#PDFToChroma.tester_acces_par_role-494"><span class="linenos">494</span></a><span class="sd">        :param query_test: La chaîne de recherche utilisée pour tester la fonctionnalité.</span>
</span><span id="PDFToChroma.tester_acces_par_role-495"><a href="#PDFToChroma.tester_acces_par_role-495"><span class="linenos">495</span></a><span class="sd">        :type query_test: str</span>
</span><span id="PDFToChroma.tester_acces_par_role-496"><a href="#PDFToChroma.tester_acces_par_role-496"><span class="linenos">496</span></a>
</span><span id="PDFToChroma.tester_acces_par_role-497"><a href="#PDFToChroma.tester_acces_par_role-497"><span class="linenos">497</span></a><span class="sd">        :return: Aucun retour. Les résultats sont affichés dans la sortie standard.</span>
</span><span id="PDFToChroma.tester_acces_par_role-498"><a href="#PDFToChroma.tester_acces_par_role-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PDFToChroma.tester_acces_par_role-499"><a href="#PDFToChroma.tester_acces_par_role-499"><span class="linenos">499</span></a>        <span class="n">query_test</span> <span class="o">=</span> <span class="s2">&quot;rapport&quot;</span>
</span><span id="PDFToChroma.tester_acces_par_role-500"><a href="#PDFToChroma.tester_acces_par_role-500"><span class="linenos">500</span></a>
</span><span id="PDFToChroma.tester_acces_par_role-501"><a href="#PDFToChroma.tester_acces_par_role-501"><span class="linenos">501</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== TEST DES NIVEAUX D&#39;ACCÈS ===&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.tester_acces_par_role-502"><a href="#PDFToChroma.tester_acces_par_role-502"><span class="linenos">502</span></a>
</span><span id="PDFToChroma.tester_acces_par_role-503"><a href="#PDFToChroma.tester_acces_par_role-503"><span class="linenos">503</span></a>        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]:</span>
</span><span id="PDFToChroma.tester_acces_par_role-504"><a href="#PDFToChroma.tester_acces_par_role-504"><span class="linenos">504</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Test pour rôle: </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
</span><span id="PDFToChroma.tester_acces_par_role-505"><a href="#PDFToChroma.tester_acces_par_role-505"><span class="linenos">505</span></a>            <span class="n">resultats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rechercher_pdfs</span><span class="p">(</span><span class="n">query_test</span><span class="p">,</span> <span class="n">user_role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Effectue un test des niveaux d'accès à une fonctionnalité de recherche de PDF selon
des rôles spécifiques.</p>

<p>Le test est effectué pour les rôles suivants : 'public', 'internal' et 'admin'.
Pour chacun de ces rôles, une recherche est réalisée avec un mot-clé donné, et les
résultats sont imprimés pour inspection. Cette méthode sert à évaluer si les restrictions
d'accès basées sur les rôles fonctionnent correctement.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query_test</strong>:  La chaîne de recherche utilisée pour tester la fonctionnalité.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Aucun retour. Les résultats sont affichés dans la sortie standard.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-508"><a href="#main-508"><span class="linenos">508</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="main-509"><a href="#main-509"><span class="linenos">509</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-510"><a href="#main-510"><span class="linenos">510</span></a><span class="sd">    Classe principale pour la gestion et le traitement des documents PDF en vue d&#39;une conversion</span>
</span><span id="main-511"><a href="#main-511"><span class="linenos">511</span></a><span class="sd">    en représentations chromatiques. Cette classe intègre également une gestion des niveaux</span>
</span><span id="main-512"><a href="#main-512"><span class="linenos">512</span></a><span class="sd">    d&#39;accès basés sur différents rôles.</span>
</span><span id="main-513"><a href="#main-513"><span class="linenos">513</span></a>
</span><span id="main-514"><a href="#main-514"><span class="linenos">514</span></a><span class="sd">    Méthodes :</span>
</span><span id="main-515"><a href="#main-515"><span class="linenos">515</span></a><span class="sd">        - traiter_tous_les_pdfs : Méthode permettant de traiter un ensemble de fichiers PDF</span>
</span><span id="main-516"><a href="#main-516"><span class="linenos">516</span></a><span class="sd">          à partir d&#39;un répertoire donné.</span>
</span><span id="main-517"><a href="#main-517"><span class="linenos">517</span></a><span class="sd">        - stats_collection : Méthode permettant d&#39;afficher les statistiques associées</span>
</span><span id="main-518"><a href="#main-518"><span class="linenos">518</span></a><span class="sd">          au traitement des fichiers PDF.</span>
</span><span id="main-519"><a href="#main-519"><span class="linenos">519</span></a><span class="sd">        - tester_acces_par_role : Méthode utilisée pour tester les autorisations d&#39;accès</span>
</span><span id="main-520"><a href="#main-520"><span class="linenos">520</span></a><span class="sd">          basées sur les rôles d&#39;utilisateur ou les niveaux d&#39;autorisation.</span>
</span><span id="main-521"><a href="#main-521"><span class="linenos">521</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-522"><a href="#main-522"><span class="linenos">522</span></a>
</span><span id="main-523"><a href="#main-523"><span class="linenos">523</span></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">PDFToChroma</span><span class="p">()</span>
</span><span id="main-524"><a href="#main-524"><span class="linenos">524</span></a>
</span><span id="main-525"><a href="#main-525"><span class="linenos">525</span></a>    <span class="c1"># Traiter tous les PDFs avec gestion des niveaux d&#39;accès</span>
</span><span id="main-526"><a href="#main-526"><span class="linenos">526</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">traiter_tous_les_pdfs</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="main-527"><a href="#main-527"><span class="linenos">527</span></a>
</span><span id="main-528"><a href="#main-528"><span class="linenos">528</span></a>    <span class="c1"># Afficher statistiques avec niveaux d&#39;accès</span>
</span><span id="main-529"><a href="#main-529"><span class="linenos">529</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">stats_collection</span><span class="p">()</span>
</span><span id="main-530"><a href="#main-530"><span class="linenos">530</span></a>
</span><span id="main-531"><a href="#main-531"><span class="linenos">531</span></a>    <span class="c1"># Test des niveaux d&#39;accès</span>
</span><span id="main-532"><a href="#main-532"><span class="linenos">532</span></a>    <span class="n">processor</span><span class="o">.</span><span class="n">tester_acces_par_role</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Classe principale pour la gestion et le traitement des documents PDF en vue d'une conversion
en représentations chromatiques. Cette classe intègre également une gestion des niveaux
d'accès basés sur différents rôles.</p>

<p>Méthodes :
    - traiter_tous_les_pdfs : Méthode permettant de traiter un ensemble de fichiers PDF
      à partir d'un répertoire donné.
    - stats_collection : Méthode permettant d'afficher les statistiques associées
      au traitement des fichiers PDF.
    - tester_acces_par_role : Méthode utilisée pour tester les autorisations d'accès
      basées sur les rôles d'utilisateur ou les niveaux d'autorisation.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>